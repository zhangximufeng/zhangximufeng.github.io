(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{308:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("p"),t._m(0),a("p"),t._v(" "),t._m(1),t._v(" "),a("hr"),t._v(" "),a("p",[t._v("主从复制是一个简单的数据库同步备份的集群技术")]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),t._m(4),t._v(" "),a("p",[t._v("master.conf")]),t._v(" "),t._m(5),a("p",[t._v("master.bat")]),t._v(" "),t._m(6),t._m(7),t._v(" "),a("p",[t._v("slave.conf")]),t._v(" "),t._m(8),a("p",[t._v("slave.bat")]),t._v(" "),t._m(9),t._m(10),t._v(" "),t._m(11),t._v(" "),t._m(12),t._v(" "),a("p",[t._v("登录从服务器")]),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._v(" "),t._m(17),t._v(" "),t._m(18),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),a("p",[t._v("A服务器")]),t._v(" "),t._m(21),a("p",[t._v("B服务器")]),t._v(" "),t._m(22),a("p",[t._v("C服务器")]),t._v(" "),t._m(23),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._v(" "),t._m(28),t._v(" "),a("p",[t._v("一般情况下作为副本节点是不能进行数据库操作的，但是在读取密集的系统中读写分离是必要的")]),t._v(" "),t._m(29),t._v(" "),t._m(30),t._v(" "),a("p",[t._v("它被存储在本地数据库local中，会记录每一个操作。 如果希望在故障恢复的时候尽可能更多，可以把这个size设置的大一点")]),t._v(" "),t._m(31),t._m(32),t._v(" "),a("p",[t._v("在Mongodb里面存在另一种集群，就是分片技术,可以满足MongoDB数据量大量增长的需求。 当MongoDB存储海量的数据时，一台机器可能不足以存储数据，也可能不足以提供可接受的读写吞吐量。这时，我们就可以通过在多台机器上分割数据，使得数据库系统能存储和处理更多的数据。")]),t._v(" "),t._m(33),t._v(" "),t._m(34),t._v(" "),t._m(35),t._v(" "),a("p",[t._v("路由根据片键把不同的文档保存到不同的分片中")]),t._v(" "),t._m(36),t._v(" "),t._m(37),t._v(" "),t._m(38),t._v(" "),t._m(39),t._v(" "),t._m(40),t._m(41),t._m(42),t._m(43),t._m(44),t._v(" "),t._m(45),t._m(46),t._m(47),t._v(" "),a("p",[t._v("路由器调用mongos命令")]),t._v(" "),t._m(48),t._m(49),t._v(" "),t._m(50),t._m(51),t._v(" "),t._m(52),t._m(53),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://docs.mongodb.com/manual/reference/configuration-options/",target:"_blank",rel:"noopener noreferrer"}},[t._v("configuration-options"),a("OutboundLink")],1)])])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#主从复制"}},[this._v("主从复制")]),s("ul",[s("li",[s("a",{attrs:{href:"#_2-副本集-t52-副本集"}},[this._v("2\\. 副本集 #")])]),s("li",[s("a",{attrs:{href:"#_3-分片-t133-分片"}},[this._v("3\\. 分片 #")])]),s("li",[s("a",{attrs:{href:"#_4-参考-t234-参考"}},[this._v("4\\. 参考 #")])])])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"主从复制"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#主从复制","aria-hidden":"true"}},[this._v("#")]),this._v(" 主从复制")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("在数据库集群中要明确知道谁是主服务器，主服务器只有一台")]),this._v(" "),s("li",[this._v("从服务器要知道自己的数据源也就是知道自己的主服务器是谁")]),this._v(" "),s("li",[this._v("--master用来确定主服务器，--slave和--source 来控制从服务器")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"assets/masterslave.jpg",alt:"masterslave"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_1-1-主服务器-t11-1-主服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-主服务器-t11-1-主服务器","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.1 主服务器 [#](#t11.1 主服务器)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("dbpath"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("E:\\ms\\master\nport"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("1000\nmaster"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("true\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("mongod --config master.conf\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_1-2-从服务器-t21-2-从服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-从服务器-t21-2-从服务器","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.2 从服务器 [#](#t21.2 从服务器)")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("dbpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("E:\\p\\slave\nport"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1001\nslave"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true\nsource"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("127.0.0.1:1000\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("mongod "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("config slave"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("conf\nrs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("slaveOk")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_1-3-主从复制的其它设置项-t31-3-主从复制的其它设置项"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-主从复制的其它设置项-t31-3-主从复制的其它设置项","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.3 主从复制的其它设置项 [#](#t31.3 主从复制的其它设置项)")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("-only 从节点-> 指定复制某个数据库默认是复制全部数据库")]),t._v(" "),a("li",[t._v("-slavedelay 从节点-> 设置主数据库同步数据的延迟(单位是秒)")]),t._v(" "),a("li",[t._v("-fastsync 从节点-> 以主数据库的节点快照为节点启动从数据库")]),t._v(" "),a("li",[t._v("-autoresync 从节点->如果不同步则重新同步数据库")]),t._v(" "),a("li",[t._v("-oplogSize 主节点->设置oplog的大小(主节点操作记录存储到local的oplog中)")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_1-4-利用shell动态添加和删除主节点-t41-4-利用shell动态添加和删除主节点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-利用shell动态添加和删除主节点-t41-4-利用shell动态添加和删除主节点","aria-hidden":"true"}},[this._v("#")]),this._v(" 1.4 利用shell动态添加和删除主节点 [#](#t41.4 利用shell动态添加和删除主节点)")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("use local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nshow collections"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sources"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('//{  "host" : "127.0.0.1:8000", "source" : "main", "syncedTo" : Timestamp(1524728329, 1) }')]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sources"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("insert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1:8000'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//挂载主节点")]),t._v("\ndb"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sources"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("remove")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'127.0.0.1:8000'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//删除已经挂载的主节点")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_2-副本集-t52-副本集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-副本集-t52-副本集","aria-hidden":"true"}},[this._v("#")]),this._v(" 2. 副本集 [#](#t52. 副本集)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[this._v("MongoDB复制是将数据同步在多个服务器的过程。")]),this._v(" "),s("li",[this._v("复制提供了数据的冗余备份，并在多个服务器上存储数据副本，提高了数据的可用性， 并可以保证数据的安全性。")]),this._v(" "),s("li",[this._v("复制还允许您从硬件故障和服务中断中恢复数据。")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-1-mongodb复制原理-t62-1-mongodb复制原理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-mongodb复制原理-t62-1-mongodb复制原理","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.1 MongoDB复制原理 [#](#t62.1 MongoDB复制原理)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ul",[s("li",[s("p",[this._v("mongodb的复制至少需要两个节点。其中一个是主节点，负责处理客户端请求，其余的都是从节点，负责复制主节点上的数据。")])]),this._v(" "),s("li",[s("p",[this._v("mongodb各个节点常见的搭配方式为：一主一从、一主多从。")])]),this._v(" "),s("li",[s("p",[this._v("主节点记录在其上的所有操作oplog，从节点定期轮询主节点获取这些操作，然后对自己的数据副本执行这些操作，从而保证从节点的数据与主节点一致。")]),this._v(" "),s("p",[s("img",{attrs:{src:"assets/replication.png",alt:"replication"}})])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-1-流程-t72-1-流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-流程-t72-1-流程","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.1 流程 [#](#t72.1 流程)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("一台活跃服务器和二个备份服务器")]),this._v(" "),s("li",[this._v("当活跃服务器出现故障，这时集群根据权重算法推选出出活跃服务器")]),this._v(" "),s("li",[this._v("当原来的主服务器恢复后又会变成从服务器")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-2-配置副本集-t82-2-配置副本集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-配置副本集-t82-2-配置副本集","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.2 配置副本集 [#](#t82.2 配置副本集)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("dbpath"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("E:\\repl\\repl1\nport"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("2001\nreplSet"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("group\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("dbpath"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("E:\\repl\\repl2\nport"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("2002\nreplSet"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("group\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("dbpath"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("E:\\repl\\repl3\nport"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("2003\nreplSet"),s("span",{pre:!0,attrs:{class:"token operator"}},[this._v("=")]),this._v("group\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-3-初始化副本集-t92-3-初始化副本集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-初始化副本集-t92-3-初始化副本集","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.3 初始化副本集 [#](#t92.3 初始化副本集)")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[a("p",[t._v("rs.initiate() 启动一个新的副本集")])]),t._v(" "),a("li",[a("p",[t._v("rs.conf() 查看副本集的配置")])]),t._v(" "),a("li",[a("p",[t._v("rs.status() 命令")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("use admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" conf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"group"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"members"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:2001"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:2002"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"127.0.0.1:2003"')]),t._v("  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nrs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("initiate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("conf"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nrs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("status")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-4-高级参数-t102-4-高级参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-高级参数-t102-4-高级参数","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.4 高级参数 [#](#t102.4 高级参数)")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ul",[a("li",[t._v("standard 常规节点 参与投票有可能成为活跃节点")]),t._v(" "),a("li",[t._v("passive 副本节点 参与投票，但不能成为活跃节点")]),t._v(" "),a("li",[t._v("arbiter 仲裁节点 只参与投票，不复制节点，也不能成为活跃节点")]),t._v(" "),a("li",[t._v("priority 0到1000之间，0代表是副本节点，1到1000是常规节点")]),t._v(" "),a("li",[t._v("arbiterOnly:true 仲裁节点")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-5-读写分离操作-t112-5-读写分离操作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-读写分离操作-t112-5-读写分离操作","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.5 读写分离操作 [#](#t112.5 读写分离操作)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",[s("code",[this._v(" rs.slaveOk();\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_2-6-oplog-t122-6-oplog"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-oplog-t122-6-oplog","aria-hidden":"true"}},[this._v("#")]),this._v(" 2.6 Oplog [#](#t122.6 Oplog)")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("oplogSize "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),t._v("\nuse local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("oplog"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("rs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("find")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("limit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_3-分片-t133-分片"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-分片-t133-分片","aria-hidden":"true"}},[this._v("#")]),this._v(" 3. 分片 [#](#t133. 分片)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-1-分片架构图-t143-1-分片架构图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-分片架构图-t143-1-分片架构图","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.1 分片架构图 [#](#t143.1 分片架构图)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"assets/sharding.png",alt:"sharding"}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-2-片键-t153-2-片键"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-片键-t153-2-片键","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.2 片键 [#](#t153.2 片键)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-3-分片的应用场景-t163-3-分片的应用场景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-分片的应用场景-t163-3-分片的应用场景","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.3 分片的应用场景 [#](#t163.3  分片的应用场景)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("ol",[s("li",[this._v("单台机器无法存储")]),this._v(" "),s("li",[this._v("单台机器已经不能满足高并发操作")]),this._v(" "),s("li",[this._v("想把尽可能多的数据存放到内存中提高性能")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"_3-4-配置-t173-4-配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-配置-t173-4-配置","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.4 配置 [#](#t173.4  配置)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"_3-4-1-创建sharding副本集-t183-4-1-创建sharding副本集"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-创建sharding副本集-t183-4-1-创建sharding副本集","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.4.1 创建Sharding副本集 [#](#t183.4.1 创建Sharding副本集)")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" E:\\repl\\db2001\nmongod --port 2001 --dbpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/data/db2001  --shardsvr --replSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("shard1\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" E:\\repl/db2002\nmongod --port 2002 --dbpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/data/db2002 --shardsvr --replSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("shard1\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mongo localhost:2001")]),t._v("\nrs.initiate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'shard1'")]),t._v(", members: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id: 0, host: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:2001'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id: 1, host: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:2002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nrs.isMaster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看主从关系")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" E:\\repl\\db2003\nmongod --port 2003 --dbpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("E:\\repl\\db2003  --shardsvr --replSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("shard2\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" E:\\repl\\db2004\nmongod --port 2004 --dbpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("E:\\repl\\db2004 --shardsvr --replSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("shard2\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mongo localhost:2003")]),t._v("\nrs.initiate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'shard2'")]),t._v(", members: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id: 0, host: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:2003'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id: 1, host: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:2004'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nrs.isMaster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看主从关系")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"_3-4-2-创建一个配置服务器-t193-4-2-创建一个配置服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2-创建一个配置服务器-t193-4-2-创建一个配置服务器","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.4.2 创建一个配置服务器 [#](#t193.4.2 创建一个配置服务器)")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" E:\\repl\\db2005\nmongod --port 2005 --dbpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("E:\\repl\\db2005  --shardsvr --replSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("config\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" E:\\repl\\db2006\nmongod --port 2006 --dbpath"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("E:\\repl\\db2006  --shardsvr --replSet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("config\n")])])])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mongo localhost:2005")]),t._v("\nrs.initiate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'config'")]),t._v(", members: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id: 0, host: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:2005'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("_id: 1, host: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'localhost:2006'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nrs.isMaster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#查看主从关系")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"_3-4-2-创建路由服务器，并且连接配置服务器-t203-4-2-创建路由服务器，并且连接配置服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2-创建路由服务器，并且连接配置服务器-t203-4-2-创建路由服务器，并且连接配置服务器","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.4.2 创建路由服务器，并且连接配置服务器 [#](#t203.4.2 创建路由服务器，并且连接配置服务器)")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[this._v("mongos --port 2006 --configdb config/localhost:2005,localhost:2006\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"_3-4-3-添加分片数据库-t213-4-3-添加分片数据库"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-3-添加分片数据库-t213-4-3-添加分片数据库","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.4.3 添加分片数据库 [#](#t213.4.3 添加分片数据库)")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("mongo localhost:2006\nuse admin\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" addshard: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'shard1/localhost:2001,localhost:2002'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" addshard: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'shard2/localhost:2003,localhost:2004'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h4",{attrs:{id:"_3-4-5-在路由服务器打开数据分片功能-t223-4-5-在路由服务器打开数据分片功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-5-在路由服务器打开数据分片功能-t223-4-5-在路由服务器打开数据分片功能","aria-hidden":"true"}},[this._v("#")]),this._v(" 3.4.5 在路由服务器打开数据分片功能 [#](#t223.4.5 在路由服务器打开数据分片功能)")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("use admin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" enablesharding: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'school'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" db.runCommand"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" shardcollection: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'school.students'")]),t._v(", key: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name: 1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"_4-参考-t234-参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-参考-t234-参考","aria-hidden":"true"}},[this._v("#")]),this._v(" 4. 参考 [#](#t234. 参考)")])}],!1,null,null,null);s.default=e.exports}}]);