<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>掘金爬虫 | Myfun&#39;s Blog</title>
    <meta name="description" content="爬虫">
    <link rel="icon" href="/favicon.ico">
    <meta name="keywords" content="爬虫">
    <link rel="preload" href="/assets/css/0.styles.6bc9bf16.css" as="style"><link rel="preload" href="/assets/js/app.35b69267.js" as="script"><link rel="preload" href="/assets/js/90.fb4057a1.js" as="script"><link rel="prefetch" href="/assets/js/10.a2f6c6ac.js"><link rel="prefetch" href="/assets/js/100.24b9a366.js"><link rel="prefetch" href="/assets/js/101.085f0585.js"><link rel="prefetch" href="/assets/js/102.66d5674f.js"><link rel="prefetch" href="/assets/js/103.7f71429c.js"><link rel="prefetch" href="/assets/js/104.13b0f535.js"><link rel="prefetch" href="/assets/js/105.0a093e85.js"><link rel="prefetch" href="/assets/js/106.a4a1db62.js"><link rel="prefetch" href="/assets/js/107.2634aacf.js"><link rel="prefetch" href="/assets/js/108.b393516d.js"><link rel="prefetch" href="/assets/js/109.769b78fb.js"><link rel="prefetch" href="/assets/js/11.fb483cc4.js"><link rel="prefetch" href="/assets/js/12.24a41994.js"><link rel="prefetch" href="/assets/js/13.a4762474.js"><link rel="prefetch" href="/assets/js/14.4a737bc9.js"><link rel="prefetch" href="/assets/js/15.548f4e99.js"><link rel="prefetch" href="/assets/js/16.b0d2654c.js"><link rel="prefetch" href="/assets/js/17.d43ab467.js"><link rel="prefetch" href="/assets/js/18.0c8f5f87.js"><link rel="prefetch" href="/assets/js/19.19ef59f8.js"><link rel="prefetch" href="/assets/js/2.436a35aa.js"><link rel="prefetch" href="/assets/js/20.24296203.js"><link rel="prefetch" href="/assets/js/21.c486888f.js"><link rel="prefetch" href="/assets/js/22.7e2305f9.js"><link rel="prefetch" href="/assets/js/23.e55bab1b.js"><link rel="prefetch" href="/assets/js/24.1468433c.js"><link rel="prefetch" href="/assets/js/25.6d82837f.js"><link rel="prefetch" href="/assets/js/26.3c4b2f18.js"><link rel="prefetch" href="/assets/js/27.21725a4f.js"><link rel="prefetch" href="/assets/js/28.db16c479.js"><link rel="prefetch" href="/assets/js/29.cb9512e5.js"><link rel="prefetch" href="/assets/js/3.5c82c0f7.js"><link rel="prefetch" href="/assets/js/30.a4c25096.js"><link rel="prefetch" href="/assets/js/31.81741530.js"><link rel="prefetch" href="/assets/js/32.da6d2ac6.js"><link rel="prefetch" href="/assets/js/33.f6164ecd.js"><link rel="prefetch" href="/assets/js/34.0344ad22.js"><link rel="prefetch" href="/assets/js/35.07d4c8d3.js"><link rel="prefetch" href="/assets/js/36.2c6adcff.js"><link rel="prefetch" href="/assets/js/37.ceb5e95e.js"><link rel="prefetch" href="/assets/js/38.d39e96e5.js"><link rel="prefetch" href="/assets/js/39.fcf34164.js"><link rel="prefetch" href="/assets/js/4.267db630.js"><link rel="prefetch" href="/assets/js/40.bdf31768.js"><link rel="prefetch" href="/assets/js/41.cc61eccd.js"><link rel="prefetch" href="/assets/js/42.042e4349.js"><link rel="prefetch" href="/assets/js/43.b385d348.js"><link rel="prefetch" href="/assets/js/44.7669f3e2.js"><link rel="prefetch" href="/assets/js/45.2fb532f4.js"><link rel="prefetch" href="/assets/js/46.0cc86442.js"><link rel="prefetch" href="/assets/js/47.30448b83.js"><link rel="prefetch" href="/assets/js/48.8893a5ed.js"><link rel="prefetch" href="/assets/js/49.ed7be1ae.js"><link rel="prefetch" href="/assets/js/5.d8a5933e.js"><link rel="prefetch" href="/assets/js/50.e4af394b.js"><link rel="prefetch" href="/assets/js/51.502ca2a7.js"><link rel="prefetch" href="/assets/js/52.f9768ea6.js"><link rel="prefetch" href="/assets/js/53.0c762369.js"><link rel="prefetch" href="/assets/js/54.dad23d00.js"><link rel="prefetch" href="/assets/js/55.4298d6a4.js"><link rel="prefetch" href="/assets/js/56.d8505fa7.js"><link rel="prefetch" href="/assets/js/57.63d197ce.js"><link rel="prefetch" href="/assets/js/58.ae9a3671.js"><link rel="prefetch" href="/assets/js/59.cb04d7cd.js"><link rel="prefetch" href="/assets/js/6.a83fef9a.js"><link rel="prefetch" href="/assets/js/60.0cedb385.js"><link rel="prefetch" href="/assets/js/61.a5c3f820.js"><link rel="prefetch" href="/assets/js/62.fc2d969d.js"><link rel="prefetch" href="/assets/js/63.53f087e3.js"><link rel="prefetch" href="/assets/js/64.9384bc9a.js"><link rel="prefetch" href="/assets/js/65.bb5db767.js"><link rel="prefetch" href="/assets/js/66.86940f42.js"><link rel="prefetch" href="/assets/js/67.37215862.js"><link rel="prefetch" href="/assets/js/68.e0c14875.js"><link rel="prefetch" href="/assets/js/69.276f0d65.js"><link rel="prefetch" href="/assets/js/7.7e7cde5e.js"><link rel="prefetch" href="/assets/js/70.0fb38ae4.js"><link rel="prefetch" href="/assets/js/71.7c824b27.js"><link rel="prefetch" href="/assets/js/72.bc39810c.js"><link rel="prefetch" href="/assets/js/73.9917d9a4.js"><link rel="prefetch" href="/assets/js/74.7912f7da.js"><link rel="prefetch" href="/assets/js/75.c193b7ec.js"><link rel="prefetch" href="/assets/js/76.ecd4e536.js"><link rel="prefetch" href="/assets/js/77.842c5aba.js"><link rel="prefetch" href="/assets/js/78.0a67366d.js"><link rel="prefetch" href="/assets/js/79.324df7d4.js"><link rel="prefetch" href="/assets/js/8.7063c274.js"><link rel="prefetch" href="/assets/js/80.68c6326b.js"><link rel="prefetch" href="/assets/js/81.a7df7b21.js"><link rel="prefetch" href="/assets/js/82.abd9c0c2.js"><link rel="prefetch" href="/assets/js/83.fd0d8457.js"><link rel="prefetch" href="/assets/js/84.148b432c.js"><link rel="prefetch" href="/assets/js/85.32148693.js"><link rel="prefetch" href="/assets/js/86.7dc5fe11.js"><link rel="prefetch" href="/assets/js/87.bd1be392.js"><link rel="prefetch" href="/assets/js/88.2c0b86aa.js"><link rel="prefetch" href="/assets/js/89.3038cc8d.js"><link rel="prefetch" href="/assets/js/9.5cab2997.js"><link rel="prefetch" href="/assets/js/91.4aa5adaf.js"><link rel="prefetch" href="/assets/js/92.aea0a62e.js"><link rel="prefetch" href="/assets/js/93.e2d0e9a7.js"><link rel="prefetch" href="/assets/js/94.a9e33a20.js"><link rel="prefetch" href="/assets/js/95.7c55098e.js"><link rel="prefetch" href="/assets/js/96.c8dfe1c0.js"><link rel="prefetch" href="/assets/js/97.35fc7df3.js"><link rel="prefetch" href="/assets/js/98.551b3ede.js"><link rel="prefetch" href="/assets/js/99.a8f5ffc4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6bc9bf16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="wrap"><div class="theme-container container no-sidebar"><header class="navbar"><div class="nav-header"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" class="logo"> <span class="site-name can-hide">
        Myfun's Blog
      </span></a> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/interview/" class="nav-link">InterviewMap</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/css_tricks/" target="_blank" rel="noopener noreferrer" class="nav-link">CSS_Tricks</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/js_tricks/" target="_blank" rel="noopener noreferrer" class="nav-link">JS_Tricks</a></div><div class="nav-item"><a href="/tags/" class="nav-link">Tags</a></div><div class="nav-item"><a href="https://github.com/zhangximufeng" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/animate_resume_ts/" target="_blank" rel="noopener noreferrer" class="nav-link">About</a></div> <!----></nav> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/interview/" class="nav-link">InterviewMap</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/css_tricks/" target="_blank" rel="noopener noreferrer" class="nav-link">CSS_Tricks</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/js_tricks/" target="_blank" rel="noopener noreferrer" class="nav-link">JS_Tricks</a></div><div class="nav-item"><a href="/tags/" class="nav-link">Tags</a></div><div class="nav-item"><a href="https://github.com/zhangximufeng" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/animate_resume_ts/" target="_blank" rel="noopener noreferrer" class="nav-link">About</a></div> <!----></nav> <!----></div> <div class="page-container"><div><div class="page card"><div class="content-header"><!----> <span class="page-timestamp">2018-09-29</span></div> <div class="content"><p></p><div class="table-of-contents"><ul><li><a href="#掘金爬虫">掘金爬虫</a><ul><li><a href="#_2-核心步骤-t12-核心步骤">2\. 核心步骤 #</a></li><li><a href="#_3-核心类库-t23-核心类库">3\. 核心类库 #</a></li><li><a href="#_3-9-http代理工具-t513-9-http代理工具">3.9 HTTP代理工具 #</a></li><li><a href="#参考-t56参考">参考 #</a></li></ul></li></ul></div><p></p> <h1 id="掘金爬虫"><a href="#掘金爬虫" aria-hidden="true" class="header-anchor">#</a> 掘金爬虫</h1> <hr> <p>通过一个实例来介绍如何编写网络爬虫抓去掘金数据，并存储到MySQL数据库中，以及定时任务爬虫来更新内容</p> <h2 id="_2-核心步骤-t12-核心步骤"><a href="#_2-核心步骤-t12-核心步骤" aria-hidden="true" class="header-anchor">#</a> 2. 核心步骤 [#](#t12. 核心步骤)</h2> <ol><li>发起HTTP请求获取网页内容</li> <li>使用类似jQuery的语法来操作网页提取需要的数据</li> <li>把数据保存到数据库中以供查询</li> <li>建立一个服务器来显示这些数据</li> <li>可以定时爬取数据</li> <li>让程序稳定运行</li> <li>对编码进行转换</li></ol> <h2 id="_3-核心类库-t23-核心类库"><a href="#_3-核心类库-t23-核心类库" aria-hidden="true" class="header-anchor">#</a> 3. 核心类库 [#](#t23. 核心类库)</h2> <h3 id="_3-1-request-t33-1-request"><a href="#_3-1-request-t33-1-request" aria-hidden="true" class="header-anchor">#</a> 3.1 request [#](#t33.1 request)</h3> <ul><li><a href="https://nodei.co/npm/request" target="_blank" rel="noopener noreferrer">npm request<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://github.com/request/request" target="_blank" rel="noopener noreferrer">github request<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h4 id="_3-1-1-安装-t43-1-1-安装"><a href="#_3-1-1-安装-t43-1-1-安装" aria-hidden="true" class="header-anchor">#</a> 3.1.1 安装 [#](#t43.1.1 安装)</h4> <pre><code>npm install --save request
</code></pre> <h4 id="_3-1-2-get请求-t53-1-2-get请求"><a href="#_3-1-2-get请求-t53-1-2-get请求" aria-hidden="true" class="header-anchor">#</a> 3.1.2 GET请求 [#](#t53.1.2 GET请求)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">request</span><span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> response<span class="token punctuation">,</span> body<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>statusCode <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><h4 id="_3-1-3-post-application-json-t63-1-3-post-application-json"><a href="#_3-1-3-post-application-json-t63-1-3-post-application-json" aria-hidden="true" class="header-anchor">#</a> 3.1.3 POST application/json [#](#t63.1.3 POST application/json)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> request<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> options<span class="token operator">=</span><span class="token punctuation">{</span>
    url<span class="token punctuation">:</span> <span class="token string">'http://localhost:8080/post'</span><span class="token punctuation">,</span>
    method<span class="token punctuation">:</span><span class="token string">'POST'</span><span class="token punctuation">,</span>
    json<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    headers<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;application/json&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    body<span class="token punctuation">:</span> <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">&quot;zxmf&quot;</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span>response<span class="token punctuation">,</span>body<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>statusCode <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-1-4-post-application-x-www-form-urlencoded-t73-1-4-post-application-x-www-form-urlencoded"><a href="#_3-1-4-post-application-x-www-form-urlencoded-t73-1-4-post-application-x-www-form-urlencoded" aria-hidden="true" class="header-anchor">#</a> 3.1.4 POST application/x-www-form-urlencoded [#](#t73.1.4 POST application/x-www-form-urlencoded)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> request<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> options<span class="token operator">=</span><span class="token punctuation">{</span>
    url<span class="token punctuation">:</span> <span class="token string">'http://localhost:8080/form'</span><span class="token punctuation">,</span>
    method<span class="token punctuation">:</span><span class="token string">'POST'</span><span class="token punctuation">,</span>
    json<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    form<span class="token punctuation">:</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'zxmf'</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">request</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span>response<span class="token punctuation">,</span>body<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error <span class="token operator">&amp;&amp;</span> response<span class="token punctuation">.</span>statusCode <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-1-5-post-multipart-form-data-t83-1-5-post-multipart-form-data"><a href="#_3-1-5-post-multipart-form-data-t83-1-5-post-multipart-form-data" aria-hidden="true" class="header-anchor">#</a> 3.1.5 POST multipart/form-data [#](#t83.1.5 POST multipart/form-data)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> request<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> formData <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'zxmf'</span><span class="token punctuation">,</span>
    avatar<span class="token punctuation">:</span><span class="token punctuation">{</span>
      value<span class="token punctuation">:</span>  fs<span class="token punctuation">.</span><span class="token function">createReadStream</span><span class="token punctuation">(</span><span class="token string">'avatar.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        filename<span class="token punctuation">:</span> <span class="token string">'avatar.jpg'</span><span class="token punctuation">,</span>
        contentType<span class="token punctuation">:</span> <span class="token string">'image/jpeg'</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
request<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token punctuation">:</span><span class="token string">'http://localhost:8080/upload'</span><span class="token punctuation">,</span> formData<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> response<span class="token punctuation">,</span> body<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>error<span class="token operator">&amp;&amp;</span>response<span class="token punctuation">.</span>statusCode<span class="token operator">==</span><span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-2-cheerio-t93-2-cheerio"><a href="#_3-2-cheerio-t93-2-cheerio" aria-hidden="true" class="header-anchor">#</a> 3.2 cheerio [#](#t93.2 cheerio)</h3> <p><a href="https://www.npmjs.com/package/cheerio" target="_blank" rel="noopener noreferrer">cheerio<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个node的库，可以理解为一个Node.js版本的jquery，使用方式和jquery基本相同。</p> <h4 id="_3-2-1-安装-t103-2-1-安装"><a href="#_3-2-1-安装-t103-2-1-安装" aria-hidden="true" class="header-anchor">#</a> 3.2.1 安装 [#](#t103.2.1 安装)</h4> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> cheerio
</code></pre></div><h4 id="_3-2-2-load装载dom-t113-2-2-load装载dom"><a href="#_3-2-2-load装载dom-t113-2-2-load装载dom" aria-hidden="true" class="header-anchor">#</a> 3.2.2 load装载DOM [#](#t113.2.2 load装载DOM)</h4> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">let</span> str<span class="token operator">=</span><span class="token template-string"><span class="token string">`
&lt;h2 class=&quot;title&quot;&gt;Hello world&lt;/h2&gt;
`</span></span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cheerio<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> $<span class="token operator">=</span>cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'h2.title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token string">'hello there!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'h2'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'welcome'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>$<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-2-3-选择器-t123-2-3-选择器"><a href="#_3-2-3-选择器-t123-2-3-选择器" aria-hidden="true" class="header-anchor">#</a> 3.2.3 选择器 [#](#t123.2.3 选择器)</h4> <ul><li><p>选择器在 Context 范围内搜索，Context又在Root范围内搜索。</p></li> <li><p>root在右，context在左</p></li> <li><p>selector 和context可以是一个字符串表达式，DOM元素，和DOM元素的数组，或者chreeio对象。</p></li> <li><p>root 是通常是HTML 文档字符串。</p> <p>$(selectior,[context],[root])</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> html<span class="token operator">=</span><span class="token template-string"><span class="token string">`
&lt;ul id=&quot;fruits&quot;&gt;
  &lt;li class=&quot;apple&quot;&gt;Apple&lt;/li&gt;
  &lt;li class=&quot;orange&quot;&gt;Orange&lt;/li&gt;
  &lt;li class=&quot;pear&quot;&gt;Pear&lt;/li&gt;
&lt;/ul&gt;
`</span></span><span class="token punctuation">;</span>

<span class="token keyword">let</span> cheerio<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> $<span class="token operator">=</span>cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.apple'</span><span class="token punctuation">,</span><span class="token string">'#fruits'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_3-2-5-attr修改属性-t133-2-5-attr修改属性"><a href="#_3-2-5-attr修改属性-t133-2-5-attr修改属性" aria-hidden="true" class="header-anchor">#</a> 3.2.5 attr修改属性 [#](#t133.2.5 attr修改属性)</h4> <ul><li><p>获得和修改属性</p></li> <li><p>在匹配的元素中只能获得第一元素的属性。</p></li> <li><p>如果设置一个属性的值为null，则移除这个属性</p></li> <li><p>你也可以传递一对键值，或者一个函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">attr</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span>value<span class="token punctuation">)</span>


console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.apple'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span><span class="token string">'favorite'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">,</span><span class="token string">'favorite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.apple'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span><span class="token string">'favorite'</span><span class="token punctuation">,</span><span class="token keyword">class</span><span class="token punctuation">:</span><span class="token string">'favorite'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.favorite'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div></li></ul> <h4 id="_3-2-6-removeattr-name"><a href="#_3-2-6-removeattr-name" aria-hidden="true" class="header-anchor">#</a> 3.2.6 removeAttr(name)</h4> <p>通过name删除属性</p> <pre><code>$('.favorite').removeAttr('id');
</code></pre> <h4 id="_3-2-7-prop-修改状态值"><a href="#_3-2-7-prop-修改状态值" aria-hidden="true" class="header-anchor">#</a> 3.2.7 prop()修改状态值</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;checkbox&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'checked'</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; false</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;checkbox&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prop</span><span class="token punctuation">(</span><span class="token string">'checked'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; ok</span>
</code></pre></div><h4 id="_3-2-8-data-自定义属性"><a href="#_3-2-8-data-自定义属性" aria-hidden="true" class="header-anchor">#</a> 3.2.8 data()自定义属性</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;div data-apple-color=&quot;red&quot;&gt;&lt;/div&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; { appleColor: 'red' }</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;div data-apple-color=&quot;red&quot;&gt;&lt;/div&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">'apple-color'</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; 'red'</span>

<span class="token keyword">var</span> apple <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.apple'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">'kind'</span><span class="token punctuation">,</span> <span class="token string">'mac'</span><span class="token punctuation">)</span>
apple<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span><span class="token string">'kind'</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; 'mac'</span>
</code></pre></div><h4 id="_3-2-9-val-赋值"><a href="#_3-2-9-val-赋值" aria-hidden="true" class="header-anchor">#</a> 3.2.9 val()赋值</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;text&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; input_text</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'input[type=&quot;text&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; &lt;input type=&quot;text&quot; value=&quot;test&quot;/&gt;</span>
</code></pre></div><h4 id="_3-2-10-hasclass-classname"><a href="#_3-2-10-hasclass-classname" aria-hidden="true" class="header-anchor">#</a> 3.2.10 hasClass( className )</h4> <p>检查匹配的元素是否有给出的类名</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pear'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasClass</span><span class="token punctuation">(</span><span class="token string">'pear'</span><span class="token punctuation">)</span><span class="token comment">//=&gt; true</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'apple'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasClass</span><span class="token punctuation">(</span><span class="token string">'fruit'</span><span class="token punctuation">)</span><span class="token comment">//=&gt; false</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">hasClass</span><span class="token punctuation">(</span><span class="token string">'pear'</span><span class="token punctuation">)</span><span class="token comment">//=&gt; true</span>
</code></pre></div><h4 id="_3-2-11-addclass-name"><a href="#_3-2-11-addclass-name" aria-hidden="true" class="header-anchor">#</a> 3.2.11 addClass(name)</h4> <p>增加class(es)给所有匹配的elements.也可以传函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pear'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'fruit'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//=&gt; &lt;li class=&quot;pear fruit&quot;&gt;Pear&lt;/li&gt;</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.apple'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'fruit red'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//=&gt; &lt;li class=&quot;apple fruit red&quot;&gt;Apple&lt;/li&gt;</span>
</code></pre></div><h4 id="_3-2-12-emoveclass-classname"><a href="#_3-2-12-emoveclass-classname" aria-hidden="true" class="header-anchor">#</a> 3.2.12 emoveClass([className])</h4> <p>从选择的elements里去除一个或多个有空格分开的class。如果className 没有定义，所有的classes将会被去除，也可以传函数</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pear'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token string">'pear'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//=&gt;Pear</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.apple'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addClass</span><span class="token punctuation">(</span><span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">removeClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//=&gt;Apple</span>
</code></pre></div><h4 id="_3-2-13-find-selector"><a href="#_3-2-13-find-selector" aria-hidden="true" class="header-anchor">#</a> 3.2.13 find(selector)</h4> <p>获得一个在匹配的元素中由选择器滤过的后代</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#fruits'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token comment">//=&gt; 3</span>
</code></pre></div><h4 id="_3-2-14-parent-selector"><a href="#_3-2-14-parent-selector" aria-hidden="true" class="header-anchor">#</a> 3.2.14 parent([selector])</h4> <p>获得通过选择器筛选匹配的元素的parent集合</p> <pre><code>$('.orange').parents().length// =&gt; 2
$('.orange').parents('#fruits').length// =&gt; 1
</code></pre> <h4 id="_3-2-15-next-获得第一个本元素之后的同级元素"><a href="#_3-2-15-next-获得第一个本元素之后的同级元素" aria-hidden="true" class="header-anchor">#</a> 3.2.15 next()获得第一个本元素之后的同级元素</h4> <pre><code>$('.apple').next().hasClass('orange')//=&gt; true
$('.pear').next().html()//=&gt; null
</code></pre> <h4 id="_3-2-16-nextall"><a href="#_3-2-16-nextall" aria-hidden="true" class="header-anchor">#</a> 3.2.16 .nextAll()</h4> <p>获得本元素之后的所有同级元素</p> <pre><code>$('.apple').nextAll()//=&gt; [&lt;li class=&quot;orange&quot;&gt;Orange&lt;/li&gt;, &lt;li class=&quot;pear&quot;&gt;Pear&lt;/li&gt;]
$('.apple').nextAll().length//=&gt;2
</code></pre> <h4 id="_3-2-17-prev"><a href="#_3-2-17-prev" aria-hidden="true" class="header-anchor">#</a> 3.2.17 prev()</h4> <p>获得本元素之前的第一个同级元素</p> <pre><code>$('.orange').prev().hasClass('apple')//=&gt; true
</code></pre> <h4 id="_3-2-18-preall"><a href="#_3-2-18-preall" aria-hidden="true" class="header-anchor">#</a> 3.2.18 preAll()</h4> <p>获得本元素前的所有同级元素</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pear'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prevAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//=&gt; [&lt;li class=&quot;orange&quot;&gt;Orange&lt;/li&gt;, &lt;li class=&quot;apple&quot;&gt;Apple&lt;/li&gt;]</span>
</code></pre></div><h4 id="_3-2-19-slice-start-end"><a href="#_3-2-19-slice-start-end" aria-hidden="true" class="header-anchor">#</a> 3.2.19 slice(start,[end])</h4> <p>获得选定范围内的元素数组</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//=&gt; 'Orange'</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token comment">//=&gt; 1</span>
</code></pre></div><h4 id="_3-2-20-siblings-selector"><a href="#_3-2-20-siblings-selector" aria-hidden="true" class="header-anchor">#</a> 3.2.20 siblings(selector)</h4> <p>获得被选择的同级元素(除去自己)</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pear'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">siblings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token comment">//=&gt; 2</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pear'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">siblings</span><span class="token punctuation">(</span><span class="token string">'.orange'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token comment">//=&gt; 1</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pear'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">siblings</span><span class="token punctuation">(</span><span class="token string">'.pear'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length<span class="token comment">//=&gt; 0</span>
</code></pre></div><h4 id="_3-2-21-first"><a href="#_3-2-21-first" aria-hidden="true" class="header-anchor">#</a> 3.2.21 first()</h4> <p>会选择chreeio对象的第一个元素</p> <pre><code>('#fruits').children().first().text()//=&gt; Apple
</code></pre> <h4 id="_3-2-22-last"><a href="#_3-2-22-last" aria-hidden="true" class="header-anchor">#</a> 3.2.22 last()</h4> <p>会选择chreeio对象的最后一个元素</p> <pre><code>$('#fruits').children().last().text()//=&gt; Pear
</code></pre> <h4 id="_3-2-23-eq-i"><a href="#_3-2-23-eq-i" aria-hidden="true" class="header-anchor">#</a> 3.2.23 eq(i)</h4> <p>通过索引筛选匹配的元素。使用.eq(-i)就从最后一个元素向前数。</p> <pre><code>$('li').eq(0).text()//=&gt; Apple
$('li').eq(-1).text()//=&gt; Pear
</code></pre> <h4 id="_3-2-24-children-selector"><a href="#_3-2-24-children-selector" aria-hidden="true" class="header-anchor">#</a> 3.2.24 children(selector)</h4> <p>获被选择元素的子元素</p> <pre><code>$('#fruits').children().length//=&gt; 3
$('#fruits').children('.pear').text()//=&gt; Pear
</code></pre> <h4 id="_3-2-25-each-function-index-element"><a href="#_3-2-25-each-function-index-element" aria-hidden="true" class="header-anchor">#</a> 3.2.25 each(function(index,element))</h4> <p>迭代一个cheerio对象，为每个匹配元素执行一个函数。要提早跳出循环，返回false.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> fruits <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> elem<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fruits<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

fruits<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//=&gt; Apple, Orange, Pear</span>
</code></pre></div><h4 id="_3-2-26-map-function-index-element"><a href="#_3-2-26-map-function-index-element" aria-hidden="true" class="header-anchor">#</a> 3.2.26 map(function(index,element))</h4> <p>迭代一个cheerio对象，为每个匹配元素执行一个函数。Map会返回一个迭代结果的数组。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> el<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//=&gt; apple, orange, pear</span>
</code></pre></div><h4 id="_3-2-27-filter-selector"><a href="#_3-2-27-filter-selector" aria-hidden="true" class="header-anchor">#</a> 3.2.27 filter(selector)</h4> <ul><li>迭代一个cheerio对象，滤出匹配选择器或者是传进去的函数的元素。</li> <li>如果使用函数方法，这个函数在被选择的元素中执行，所以this指向的手势当前元素。</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'.orange'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//=&gt; orange</span>

<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'li'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> el<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// this === el</span>

    <span class="token keyword">return</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'orange'</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">attr</span><span class="token punctuation">(</span><span class="token string">'class'</span><span class="token punctuation">)</span>；

<span class="token comment">//=&gt; orange</span>
</code></pre></div><h4 id="_3-2-28-append-content-content…"><a href="#_3-2-28-append-content-content…" aria-hidden="true" class="header-anchor">#</a> 3.2.28 append(content,[content…])</h4> <p>在每个元素最后插入一个子元素</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">'&lt;li class=&quot;plum&quot;&gt;Plum&lt;/li&gt;'</span><span class="token punctuation">)</span>
$<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt;</span>
<span class="token comment">// &lt;li class=&quot;apple&quot;&gt;Apple&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;orange&quot;&gt;Orange&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;pear&quot;&gt;Pear&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;plum&quot;&gt;Plum&lt;/li&gt;//</span>
</code></pre></div><h4 id="_3-2-29-prepend-content-content-…"><a href="#_3-2-29-prepend-content-content-…" aria-hidden="true" class="header-anchor">#</a> 3.2.29 prepend(content,[content,…])</h4> <p>在每个元素最前插入一个子元素</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">prepend</span><span class="token punctuation">(</span><span class="token string">'&lt;li class=&quot;plum&quot;&gt;Plum&lt;/li&gt;'</span><span class="token punctuation">)</span>
$<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt;</span>
<span class="token comment">// &lt;li class=&quot;plum&quot;&gt;Plum&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;apple&quot;&gt;Apple&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;orange&quot;&gt;Orange&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;pear&quot;&gt;Pear&lt;/li&gt;</span>
</code></pre></div><h4 id="_3-2-30-after-content-content-…"><a href="#_3-2-30-after-content-content-…" aria-hidden="true" class="header-anchor">#</a> 3.2.30 after(content,[content,…])</h4> <p>在每个匹配元素之后插入一个元素</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.apple'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span><span class="token string">'&lt;li class=&quot;plum&quot;&gt;Plum&lt;/li&gt;'</span><span class="token punctuation">)</span>
$<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt;</span>
<span class="token comment">// &lt;li class=&quot;apple&quot;&gt;Apple&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;plum&quot;&gt;Plum&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;orange&quot;&gt;Orange&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;pear&quot;&gt;Pear&lt;/li&gt;</span>
</code></pre></div><h4 id="_3-2-31-before-content-content-…"><a href="#_3-2-31-before-content-content-…" aria-hidden="true" class="header-anchor">#</a> 3.2.31 before(content,[content,…])</h4> <p>在每个匹配的元素之前插入一个元素</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.apple'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token string">'&lt;li class=&quot;plum&quot;&gt;Plum&lt;/li&gt;'</span><span class="token punctuation">)</span>
$<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt;</span>
<span class="token comment">// &lt;li class=&quot;plum&quot;&gt;Plum&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;apple&quot;&gt;Apple&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;orange&quot;&gt;Orange&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;pear&quot;&gt;Pear&lt;/li&gt;</span>
</code></pre></div><h4 id="_3-2-32-remove-selector"><a href="#_3-2-32-remove-selector" aria-hidden="true" class="header-anchor">#</a> 3.2.32 remove( [selector] )</h4> <p>从DOM中去除匹配的元素和它们的子元素。选择器用来筛选要删除的元素。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pear'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
$<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//=&gt;</span>

<span class="token comment">// &lt;li class=&quot;apple&quot;&gt;Apple&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;orange&quot;&gt;Orange&lt;/li&gt;</span>
</code></pre></div><h4 id="_3-2-33-replacewith-content"><a href="#_3-2-33-replacewith-content" aria-hidden="true" class="header-anchor">#</a> 3.2.33 replaceWith( content )</h4> <p>替换匹配的的元素</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> plum <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'&lt;li class=&quot;plum&quot;&gt;Plum&lt;/li&gt;'</span><span class="token punctuation">)</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.pear'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceWith</span><span class="token punctuation">(</span>plum<span class="token punctuation">)</span>
$<span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt;</span>
<span class="token comment">// &lt;li class=&quot;apple&quot;&gt;Apple&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;orange&quot;&gt;Orange&lt;/li&gt;</span>
<span class="token comment">// &lt;li class=&quot;plum&quot;&gt;Plum&lt;/li&gt;//</span>
</code></pre></div><h4 id="_3-2-34-empty"><a href="#_3-2-34-empty" aria-hidden="true" class="header-anchor">#</a> 3.2.34 empty()</h4> <p>清空一个元素，移除所有的子元素</p> <pre><code>$('ul').empty()$.html()
</code></pre> <h4 id="_3-2-35-html-htmlstring"><a href="#_3-2-35-html-htmlstring" aria-hidden="true" class="header-anchor">#</a> 3.2.35 html( [htmlString] )</h4> <p>获得元素的HTML字符串。如果htmlString有内容的话，将会替代原来的HTML</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.orange'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; Orange</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#fruits'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">'&lt;li class=&quot;mango&quot;&gt;Mango&lt;/li&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">//=&gt; &lt;li class=&quot;mango&quot;&gt;Mango&lt;/li&gt;</span>
</code></pre></div><h4 id="_3-2-36-text-textstring"><a href="#_3-2-36-text-textstring" aria-hidden="true" class="header-anchor">#</a> 3.2.36 text( [textString] )</h4> <p>获得元素的text内容，包括子元素。如果textString被指定的话，每个元素的text内容都会被替换。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.orange'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//=&gt; Orange</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'ul'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//=&gt; Apple// Orange// Pear</span>
</code></pre></div><h3 id="_3-3-debug-t453-3-debug"><a href="#_3-3-debug-t453-3-debug" aria-hidden="true" class="header-anchor">#</a> 3.3 debug [#](#t453.3 debug)</h3> <ul><li><p>在编写程序的时候，有时候需要输出一些调试信息，以便排查问题。</p></li> <li><p>但是在程序运行过程中又不需要这些信息，为了方便切换而且不需要改代码，可以使用debug模块</p> <pre><code>let debug = require('debug')('app:main');
debug('现在的时间是%s',new Date());
</code></pre></li> <li><p>Window系统在命令行中执行 <code>SET DEBUG=app:*</code></p></li> <li><p>Mac系统在命令行中执行 <code>export DEBUG=app:*</code></p></li></ul> <h3 id="_3-4-corn-t463-4-corn"><a href="#_3-4-corn-t463-4-corn" aria-hidden="true" class="header-anchor">#</a> 3.4 corn [#](#t463.4 corn)</h3> <p><a href="https://www.npmjs.com/package/cron" target="_blank" rel="noopener noreferrer">cron<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>用来周期性的执行某种任务或等待处理某些事件的一个守护进程</p> <table><thead><tr><th>符号</th> <th>含义</th></tr></thead> <tbody><tr><td>星号(*)</td> <td>代表所有可能的值</td></tr> <tr><td>逗号(,)</td> <td>可以用逗号隔开的值指定一个列表范围，例如，“1,2,5,7,8,9”</td></tr> <tr><td>中杠(-)</td> <td>可以用整数之间的中杠表示一个整数范围，例如“2-6”表示“2,3,4,5,6”</td></tr> <tr><td>正斜线(/)</td> <td>可以用正斜线指定时间的间隔频率，*/10，如果用在minute字段，表示每十分钟执行一次</td></tr></tbody></table> <table><thead><tr><th>单位</th> <th>范围</th></tr></thead> <tbody><tr><td>Seconds</td> <td>0-59</td></tr> <tr><td>Minutes</td> <td>0-59</td></tr> <tr><td>Hours</td> <td>0-23</td></tr> <tr><td>Day</td> <td>1-31</td></tr> <tr><td>Months</td> <td>0-11</td></tr> <tr><td>Day of Week</td> <td>0-6</td></tr></tbody></table> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> cronJob <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cron'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>CronJob<span class="token punctuation">;</span>
<span class="token keyword">var</span> job1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">cronJob</span><span class="token punctuation">(</span><span class="token string">&quot;* * * * * *&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'每秒'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
job1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_3-5-监听未知错误-t473-5-监听未知错误"><a href="#_3-5-监听未知错误-t473-5-监听未知错误" aria-hidden="true" class="header-anchor">#</a> 3.5 监听未知错误 [#](#t473.5 监听未知错误)</h3> <ul><li><p>大部分情况下，异步的IO操作发生的错误无法被try catch捕获，如果没有捕获会导致程序退出</p></li> <li><p>在Node.js中，如果一个抛出的异常没有被try catch捕获，会尝试将错误交给uncaughtException事件处理函数来进行处理，仅当没有注册该事件处理函数时才会导致进程直接退出。</p> <div class="language-js extra-class"><pre class="language-js"><code>process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'uncaughtException'</span><span class="token punctuation">,</span><span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'uncaughtException: %s'</span><span class="token punctuation">,</span>erro<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="_3-6-pm2-t483-6-pm2"><a href="#_3-6-pm2-t483-6-pm2" aria-hidden="true" class="header-anchor">#</a> 3.6 pm2 [#](#t483.6 pm2)</h3> <p>pm2是一个功能强大的进程管理器，通过<code>pm2 start</code>来启动程序, 当该进程异常退出时,pm2会自动尝试重启进程。</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> pm2 -g
npm2 start
pm2 stop
</code></pre></div><h3 id="_3-7-编码-iconv-lite-t493-7-编码-iconv-lite"><a href="#_3-7-编码-iconv-lite-t493-7-编码-iconv-lite" aria-hidden="true" class="header-anchor">#</a> 3.7 编码(iconv-lite) [#](#t493.7 编码(iconv-lite))</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> request <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> iconv<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'iconv-lite'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> cheerio<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'cheerio'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">{</span>url<span class="token punctuation">:</span> <span class="token string">'http://top.baidu.com/buzz?b=26&amp;c=1&amp;fr=topcategory_c1'</span>
<span class="token punctuation">,</span> encoding<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>response<span class="token punctuation">,</span>body<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    body <span class="token operator">=</span> iconv<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>body<span class="token punctuation">,</span> <span class="token string">'gbk'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> $<span class="token operator">=</span>cheerio<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> movies<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.keyword .list-title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span>item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> movie<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
        movies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            name<span class="token punctuation">:</span>movie<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>movies<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-8-发送邮件-t503-8-发送邮件"><a href="#_3-8-发送邮件-t503-8-发送邮件" aria-hidden="true" class="header-anchor">#</a> 3.8 发送邮件 [#](#t503.8 发送邮件)</h3> <p><a href="https://nodemailer.com/about/" target="_blank" rel="noopener noreferrer">nodemailer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是一个简单易用的Node.js邮件发送模块</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> nodemailer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'nodemailer'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> transporter <span class="token operator">=</span> nodemailer<span class="token punctuation">.</span><span class="token function">createTransport</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// host: 'smtp.ethereal.email',</span>
    service<span class="token punctuation">:</span> <span class="token string">'qq'</span><span class="token punctuation">,</span> <span class="token comment">// 使用了内置传输发送邮件 查看支持列表：https://nodemailer.com/smtp/well-known/</span>
    port<span class="token punctuation">:</span> <span class="token number">465</span><span class="token punctuation">,</span> <span class="token comment">// SMTP 端口</span>
    secureConnection<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 使用了 SSL</span>
    auth<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        user<span class="token punctuation">:</span> <span class="token string">'83687401@qq.com'</span><span class="token punctuation">,</span>
        <span class="token comment">// 这里密码不是qq密码，是你设置的smtp授权码</span>
        pass<span class="token punctuation">:</span> <span class="token string">'gfndwuvvfpbebjdi'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> mailOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">from</span><span class="token punctuation">:</span> <span class="token string">'&quot;83687401&quot; &lt;83687401@qq.com&gt;'</span><span class="token punctuation">,</span> <span class="token comment">// sender address</span>
    to<span class="token punctuation">:</span> <span class="token string">'83687401@qq.com'</span><span class="token punctuation">,</span> <span class="token comment">// list of receivers</span>
    subject<span class="token punctuation">:</span> <span class="token string">'hello'</span><span class="token punctuation">,</span> <span class="token comment">// Subject line</span>
    <span class="token comment">// 发送text或者html格式</span>
    <span class="token comment">// text: 'Hello world?', // plain text body</span>
    html<span class="token punctuation">:</span> <span class="token string">'&lt;h1&gt;Hello world&lt;/h1&gt;'</span> <span class="token comment">// html body</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// send mail with defined transport object</span>
transporter<span class="token punctuation">.</span><span class="token function">sendMail</span><span class="token punctuation">(</span>mailOptions<span class="token punctuation">,</span> <span class="token punctuation">(</span>error<span class="token punctuation">,</span> info<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Message sent: %s'</span><span class="token punctuation">,</span> info<span class="token punctuation">.</span>messageId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Message sent: &lt;04ec7731-cc68-1ef6-303c-61b0f796b78f@qq.com&gt;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_3-9-http代理工具-t513-9-http代理工具"><a href="#_3-9-http代理工具-t513-9-http代理工具" aria-hidden="true" class="header-anchor">#</a> 3.9 HTTP代理工具 [#](#t513.9 HTTP代理工具)</h2> <ul><li>Windows 平台有 Fiddler，macOS 有 Charles，阿里有AnyProxy</li> <li>基本原理就是通过在手机客户端设置好代理IP和端口,客户端所有的 HTTP、HTTPS 请求就会经过代理工具</li></ul> <h3 id="_3-9-1-https抓包设置-t523-9-1-https抓包设置"><a href="#_3-9-1-https抓包设置-t523-9-1-https抓包设置" aria-hidden="true" class="header-anchor">#</a> 3.9.1 https抓包设置 [#](#t523.9.1 https抓包设置)</h3> <h4 id="_3-9-1-1-fiddler-t533-9-1-1-fiddler"><a href="#_3-9-1-1-fiddler-t533-9-1-1-fiddler" aria-hidden="true" class="header-anchor">#</a> 3.9.1.1 Fiddler [#](#t533.9.1.1 Fiddler)</h4> <ul><li>Tools &gt; Fiddler Options &gt; Connections
<ul><li>Fiddler listens on port 8888</li> <li>Allow remote computers to connect</li></ul></li> <li>Tools &gt; Fiddler Options &gt; HTTPS &gt; Decrypt HTTPS traffic
<ul><li>Capture HTTPS CONNECTs</li> <li>Decrypt HTTPS traffic</li></ul></li></ul> <h4 id="_3-9-1-2-android-t543-9-1-2-android"><a href="#_3-9-1-2-android-t543-9-1-2-android" aria-hidden="true" class="header-anchor">#</a> 3.9.1.2 Android [#](#t543.9.1.2 Android)</h4> <ul><li>进入手机的 WLAN 设置，选择当前所在局域网的 WiFi 链接，设置代理服务器的 IP 和端口</li> <li>访问<a href="http://192.168.31.236:8888/%E6%98%BE%E7%A4%BAecho%E9%A1%B5%E9%9D%A2" target="_blank" rel="noopener noreferrer">http://192.168.31.236:8888/显示echo页面<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>下载 FiddlerRoot certificate，下载并安装证书，并验证通过</li></ul> <h4 id="_3-9-1-3-抓取接口-t553-9-1-3-抓取接口"><a href="#_3-9-1-3-抓取接口-t553-9-1-3-抓取接口" aria-hidden="true" class="header-anchor">#</a> 3.9.1.3 抓取接口 [#](#t553.9.1.3 抓取接口)</h4> <ul><li>过滤 <code>mp.weixin.qq.com</code> 接口</li> <li>历史消息 <a href="https://mp.weixin.qq.com/mp/profile_ext" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/mp/profile_ext<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>文章详情 <a href="https://mp.weixin.qq.com/mp/getappmsgext" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/mp/getappmsgext<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="参考"><a href="#参考" aria-hidden="true" class="header-anchor">#</a> 参考 <a href="#t56%E5%8F%82%E8%80%83">#</a></h2> <ul><li><a href="https://www.telerik.com/download/fiddler" target="_blank" rel="noopener noreferrer">fiddler<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/joshua317/p/8670923.html" target="_blank" rel="noopener noreferrer">Fiddler抓取https设置详解<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div> <!----> <div class="content page-nav"><p class="inner"><span class="prev">
          ← <a href="/fe/39.crawl-2.html" class="prev">
            抓取数据
          </a></span> <span class="next"><a href="/fe/39.crawl-0.html">
            爬取内容
          </a> →
        </span></p></div> <div id="comment-container"><div class="gt-container"><div class="gt-initing"><i class="gt-loader"></i> <p class="gt-initing-text">Gitalking ...</p></div> <!----> <!----> <div><div class="gt-header"><a class="gt-avatar-github"><span class="gt-ico gt-ico-github"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64 524C64 719.602 189.356 885.926 364.113 947.017 387.65799 953 384 936.115 384 924.767L384 847.107C248.118 863.007 242.674 773.052 233.5 758.001 215 726.501 171.5 718.501 184.5 703.501 215.5 687.501 247 707.501 283.5 761.501 309.956 800.642 361.366 794.075 387.658 787.497 393.403 763.997 405.637 743.042 422.353 726.638 281.774 701.609 223 615.67 223 513.5 223 464.053 239.322 418.406 271.465 381.627 251.142 320.928 273.421 269.19 276.337 261.415 334.458 256.131 394.888 302.993 399.549 306.685 432.663 297.835 470.341 293 512.5 293 554.924 293 592.81 297.896 626.075 306.853 637.426 298.219 693.46 258.054 747.5 262.966 750.382 270.652 772.185 321.292 753.058 381.083 785.516 417.956 802 463.809 802 513.5 802 615.874 742.99 701.953 601.803 726.786 625.381 750.003 640 782.295 640 818.008L640 930.653C640.752 939.626 640 948.664978 655.086 948.665 832.344 888.962 960 721.389 960 524 960 276.576 759.424 76 512 76 264.577 76 64 276.576 64 524Z"></path>
</svg>
</span> <!----></span></a> <div class="gt-header-comment"><textarea placeholder="Leave a comment" class="gt-header-textarea"></textarea> <div class="gt-header-preview markdown-body hide"></div> <div class="gt-header-controls"><a href="https://guides.github.com/features/mastering-markdown/" target="_blank" class="gt-header-controls-tip"><span class="gt-ico gt-ico-tip"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 366.949535c-16.065554 0-29.982212 13.405016-29.982212 29.879884l0 359.070251c0 16.167882 13.405016 29.879884 29.982212 29.879884 15.963226 0 29.879884-13.405016 29.879884-29.879884L541.879884 396.829419C541.879884 380.763865 528.474868 366.949535 512 366.949535L512 366.949535z"
    p-id="3083"></path>
  <path d="M482.017788 287.645048c0-7.776956 3.274508-15.553912 8.80024-21.181973 5.525732-5.525732 13.302688-8.80024 21.181973-8.80024 7.776956 0 15.553912 3.274508 21.079644 8.80024 5.525732 5.62806 8.80024 13.405016 8.80024 21.181973 0 7.776956-3.274508 15.656241-8.80024 21.181973-5.525732 5.525732-13.405016 8.697911-21.079644 8.697911-7.879285 0-15.656241-3.274508-21.181973-8.697911C485.292295 303.301289 482.017788 295.524333 482.017788 287.645048L482.017788 287.645048z"
    p-id="3084"></path>
  <path d="M512 946.844409c-239.8577 0-434.895573-195.037873-434.895573-434.895573 0-239.8577 195.037873-434.895573 434.895573-434.895573 239.755371 0 434.895573 195.037873 434.895573 434.895573C946.895573 751.806535 751.755371 946.844409 512 946.844409zM512 126.17088c-212.740682 0-385.880284 173.037274-385.880284 385.777955 0 212.740682 173.037274 385.777955 385.880284 385.777955 212.740682 0 385.777955-173.037274 385.777955-385.777955C897.777955 299.208154 724.740682 126.17088 512 126.17088z"
    p-id="3085"></path>
</svg>
</span> <span class="gt-ico-text">Markdown is supported</span></span></a> <!----> <button class="gt-btn gt-btn-preview"><span class="gt-btn-text">Preview</span> <!----></button> <button class="gt-btn gt-btn-login"><span class="gt-btn-text">Login with GitHub</span> <!----></button></div></div></div> <div class="gt-comments"><span></span> <p class="gt-comments-null">
                Be the first guy leaving a comment!
            </p> <!----></div></div></div></div></div></div> <!----></div> <div class="tool-group"><!----></div></div> <!----></div> <div class="background-mask" style="background:#f6f6f6;"></div></div></div>
    <script src="/assets/js/app.35b69267.js" defer></script><script src="/assets/js/90.fb4057a1.js" defer></script>
  </body>
</html>
