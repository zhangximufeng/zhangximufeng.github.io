<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>通过配置项启动数据库 | Myfun&#39;s Blog</title>
    <meta name="description" content="MongoDB">
    <link rel="icon" href="/favicon.ico">
    <meta name="keywords" content="MongoDB">
    <link rel="preload" href="/assets/css/0.styles.6bc9bf16.css" as="style"><link rel="preload" href="/assets/js/app.35b69267.js" as="script"><link rel="preload" href="/assets/js/61.a5c3f820.js" as="script"><link rel="prefetch" href="/assets/js/10.a2f6c6ac.js"><link rel="prefetch" href="/assets/js/100.24b9a366.js"><link rel="prefetch" href="/assets/js/101.085f0585.js"><link rel="prefetch" href="/assets/js/102.66d5674f.js"><link rel="prefetch" href="/assets/js/103.7f71429c.js"><link rel="prefetch" href="/assets/js/104.13b0f535.js"><link rel="prefetch" href="/assets/js/105.0a093e85.js"><link rel="prefetch" href="/assets/js/106.a4a1db62.js"><link rel="prefetch" href="/assets/js/107.2634aacf.js"><link rel="prefetch" href="/assets/js/108.b393516d.js"><link rel="prefetch" href="/assets/js/109.769b78fb.js"><link rel="prefetch" href="/assets/js/11.fb483cc4.js"><link rel="prefetch" href="/assets/js/12.24a41994.js"><link rel="prefetch" href="/assets/js/13.a4762474.js"><link rel="prefetch" href="/assets/js/14.4a737bc9.js"><link rel="prefetch" href="/assets/js/15.548f4e99.js"><link rel="prefetch" href="/assets/js/16.b0d2654c.js"><link rel="prefetch" href="/assets/js/17.d43ab467.js"><link rel="prefetch" href="/assets/js/18.0c8f5f87.js"><link rel="prefetch" href="/assets/js/19.19ef59f8.js"><link rel="prefetch" href="/assets/js/2.436a35aa.js"><link rel="prefetch" href="/assets/js/20.24296203.js"><link rel="prefetch" href="/assets/js/21.c486888f.js"><link rel="prefetch" href="/assets/js/22.7e2305f9.js"><link rel="prefetch" href="/assets/js/23.e55bab1b.js"><link rel="prefetch" href="/assets/js/24.1468433c.js"><link rel="prefetch" href="/assets/js/25.6d82837f.js"><link rel="prefetch" href="/assets/js/26.3c4b2f18.js"><link rel="prefetch" href="/assets/js/27.21725a4f.js"><link rel="prefetch" href="/assets/js/28.db16c479.js"><link rel="prefetch" href="/assets/js/29.cb9512e5.js"><link rel="prefetch" href="/assets/js/3.5c82c0f7.js"><link rel="prefetch" href="/assets/js/30.a4c25096.js"><link rel="prefetch" href="/assets/js/31.81741530.js"><link rel="prefetch" href="/assets/js/32.da6d2ac6.js"><link rel="prefetch" href="/assets/js/33.f6164ecd.js"><link rel="prefetch" href="/assets/js/34.0344ad22.js"><link rel="prefetch" href="/assets/js/35.07d4c8d3.js"><link rel="prefetch" href="/assets/js/36.2c6adcff.js"><link rel="prefetch" href="/assets/js/37.ceb5e95e.js"><link rel="prefetch" href="/assets/js/38.d39e96e5.js"><link rel="prefetch" href="/assets/js/39.fcf34164.js"><link rel="prefetch" href="/assets/js/4.267db630.js"><link rel="prefetch" href="/assets/js/40.bdf31768.js"><link rel="prefetch" href="/assets/js/41.cc61eccd.js"><link rel="prefetch" href="/assets/js/42.042e4349.js"><link rel="prefetch" href="/assets/js/43.b385d348.js"><link rel="prefetch" href="/assets/js/44.7669f3e2.js"><link rel="prefetch" href="/assets/js/45.2fb532f4.js"><link rel="prefetch" href="/assets/js/46.0cc86442.js"><link rel="prefetch" href="/assets/js/47.30448b83.js"><link rel="prefetch" href="/assets/js/48.8893a5ed.js"><link rel="prefetch" href="/assets/js/49.ed7be1ae.js"><link rel="prefetch" href="/assets/js/5.d8a5933e.js"><link rel="prefetch" href="/assets/js/50.e4af394b.js"><link rel="prefetch" href="/assets/js/51.502ca2a7.js"><link rel="prefetch" href="/assets/js/52.f9768ea6.js"><link rel="prefetch" href="/assets/js/53.0c762369.js"><link rel="prefetch" href="/assets/js/54.dad23d00.js"><link rel="prefetch" href="/assets/js/55.4298d6a4.js"><link rel="prefetch" href="/assets/js/56.d8505fa7.js"><link rel="prefetch" href="/assets/js/57.63d197ce.js"><link rel="prefetch" href="/assets/js/58.ae9a3671.js"><link rel="prefetch" href="/assets/js/59.cb04d7cd.js"><link rel="prefetch" href="/assets/js/6.a83fef9a.js"><link rel="prefetch" href="/assets/js/60.0cedb385.js"><link rel="prefetch" href="/assets/js/62.fc2d969d.js"><link rel="prefetch" href="/assets/js/63.53f087e3.js"><link rel="prefetch" href="/assets/js/64.9384bc9a.js"><link rel="prefetch" href="/assets/js/65.bb5db767.js"><link rel="prefetch" href="/assets/js/66.86940f42.js"><link rel="prefetch" href="/assets/js/67.37215862.js"><link rel="prefetch" href="/assets/js/68.e0c14875.js"><link rel="prefetch" href="/assets/js/69.276f0d65.js"><link rel="prefetch" href="/assets/js/7.7e7cde5e.js"><link rel="prefetch" href="/assets/js/70.0fb38ae4.js"><link rel="prefetch" href="/assets/js/71.7c824b27.js"><link rel="prefetch" href="/assets/js/72.bc39810c.js"><link rel="prefetch" href="/assets/js/73.9917d9a4.js"><link rel="prefetch" href="/assets/js/74.7912f7da.js"><link rel="prefetch" href="/assets/js/75.c193b7ec.js"><link rel="prefetch" href="/assets/js/76.ecd4e536.js"><link rel="prefetch" href="/assets/js/77.842c5aba.js"><link rel="prefetch" href="/assets/js/78.0a67366d.js"><link rel="prefetch" href="/assets/js/79.324df7d4.js"><link rel="prefetch" href="/assets/js/8.7063c274.js"><link rel="prefetch" href="/assets/js/80.68c6326b.js"><link rel="prefetch" href="/assets/js/81.a7df7b21.js"><link rel="prefetch" href="/assets/js/82.abd9c0c2.js"><link rel="prefetch" href="/assets/js/83.fd0d8457.js"><link rel="prefetch" href="/assets/js/84.148b432c.js"><link rel="prefetch" href="/assets/js/85.32148693.js"><link rel="prefetch" href="/assets/js/86.7dc5fe11.js"><link rel="prefetch" href="/assets/js/87.bd1be392.js"><link rel="prefetch" href="/assets/js/88.2c0b86aa.js"><link rel="prefetch" href="/assets/js/89.3038cc8d.js"><link rel="prefetch" href="/assets/js/9.5cab2997.js"><link rel="prefetch" href="/assets/js/90.fb4057a1.js"><link rel="prefetch" href="/assets/js/91.4aa5adaf.js"><link rel="prefetch" href="/assets/js/92.aea0a62e.js"><link rel="prefetch" href="/assets/js/93.e2d0e9a7.js"><link rel="prefetch" href="/assets/js/94.a9e33a20.js"><link rel="prefetch" href="/assets/js/95.7c55098e.js"><link rel="prefetch" href="/assets/js/96.c8dfe1c0.js"><link rel="prefetch" href="/assets/js/97.35fc7df3.js"><link rel="prefetch" href="/assets/js/98.551b3ede.js"><link rel="prefetch" href="/assets/js/99.a8f5ffc4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6bc9bf16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="wrap"><div class="theme-container container no-sidebar"><header class="navbar"><div class="nav-header"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" class="logo"> <span class="site-name can-hide">
        Myfun's Blog
      </span></a> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/interview/" class="nav-link">InterviewMap</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/css_tricks/" target="_blank" rel="noopener noreferrer" class="nav-link">CSS_Tricks</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/js_tricks/" target="_blank" rel="noopener noreferrer" class="nav-link">JS_Tricks</a></div><div class="nav-item"><a href="/tags/" class="nav-link">Tags</a></div><div class="nav-item"><a href="https://github.com/zhangximufeng" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/animate_resume_ts/" target="_blank" rel="noopener noreferrer" class="nav-link">About</a></div> <!----></nav> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/interview/" class="nav-link">InterviewMap</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/css_tricks/" target="_blank" rel="noopener noreferrer" class="nav-link">CSS_Tricks</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/js_tricks/" target="_blank" rel="noopener noreferrer" class="nav-link">JS_Tricks</a></div><div class="nav-item"><a href="/tags/" class="nav-link">Tags</a></div><div class="nav-item"><a href="https://github.com/zhangximufeng" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/animate_resume_ts/" target="_blank" rel="noopener noreferrer" class="nav-link">About</a></div> <!----></nav> <!----></div> <div class="page-container"><div><div class="page card"><div class="content-header"><!----> <span class="page-timestamp">2018-09-29</span></div> <div class="content"><p></p><div class="table-of-contents"><ul><li><a href="#通过配置项启动数据库">通过配置项启动数据库</a><ul><li><a href="#_2-导入导出数据-t42-导入导出数据">2\. 导入导出数据 #</a></li><li><a href="#_3-备份与恢复-t93-备份与恢复">3\. 备份与恢复 #</a></li><li><a href="#_4-直接拷贝数据-t124-直接拷贝数据">4\. 直接拷贝数据 #</a></li><li><a href="#_5-锁定和解锁数据库-t135-锁定和解锁数据库">5\. 锁定和解锁数据库 #</a></li><li><a href="#_6-安全措施-t146-安全措施">6\. 安全措施 #</a></li><li><a href="#_7-数据库高级命令-t237-数据库高级命令">7\. 数据库高级命令 #</a></li><li><a href="#_8-什么固定集合-t318-什么固定集合">8\. 什么固定集合 #</a></li><li><a href="#_9-gridfs-t359-gridfs">9\. gridfs #</a></li></ul></li></ul></div><p></p> <h1 id="通过配置项启动数据库"><a href="#通过配置项启动数据库" aria-hidden="true" class="header-anchor">#</a> 通过配置项启动数据库</h1> <hr> <table><thead><tr><th>参数</th> <th>含义</th></tr></thead> <tbody><tr><td>--dbpath</td> <td>指定数据库文件的目录</td></tr> <tr><td>--port</td> <td>端口 默认是27017 28017</td></tr> <tr><td>--fork</td> <td>以后台守护的方式进行启动</td></tr> <tr><td>--logpath</td> <td>指定日志文件输出路径</td></tr> <tr><td>--config</td> <td>指定一个配置文件</td></tr> <tr><td>--auth</td> <td>以安全方式启动数据库，默认不验证</td></tr></tbody></table> <h3 id="_1-1-mongo-conf-t11-1-mongo-conf"><a href="#_1-1-mongo-conf-t11-1-mongo-conf" aria-hidden="true" class="header-anchor">#</a> 1.1 mongo.conf [#](#t11.1 mongo.conf)</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>dbpath<span class="token operator">=</span>E:\mongo\data
logpath<span class="token operator">=</span>E:\mongo\log
port<span class="token operator">=</span>50000
</code></pre></div><h3 id="_1-2-启动服务器-t21-2-启动服务器"><a href="#_1-2-启动服务器-t21-2-启动服务器" aria-hidden="true" class="header-anchor">#</a> 1.2 启动服务器 [#](#t21.2 启动服务器)</h3> <pre><code>mongod --config mongo.conf
</code></pre> <h3 id="_1-3-启动客户端-t31-3-启动客户端"><a href="#_1-3-启动客户端-t31-3-启动客户端" aria-hidden="true" class="header-anchor">#</a> 1.3 启动客户端 [#](#t31.3 启动客户端)</h3> <pre><code>mongo --port 50000
</code></pre> <h2 id="_2-导入导出数据-t42-导入导出数据"><a href="#_2-导入导出数据-t42-导入导出数据" aria-hidden="true" class="header-anchor">#</a> 2. 导入导出数据 [#](#t42. 导入导出数据)</h2> <p>这命令是保存成了文件格式</p> <ul><li>mongoimport 导出数据</li> <li>mongoexport 导入数据</li></ul> <table><thead><tr><th>参数</th> <th>含义</th></tr></thead> <tbody><tr><td>-h [ --host ]</td> <td>连接的数据库</td></tr> <tr><td>--port</td> <td>端口号</td></tr> <tr><td>-u</td> <td>用户名</td></tr> <tr><td>-p</td> <td>密码</td></tr> <tr><td>-d</td> <td>导出的数据库</td></tr> <tr><td>-d</td> <td>导出的数据库</td></tr> <tr><td>-c</td> <td>指定导出的集合</td></tr> <tr><td>-o</td> <td>导出的文件存储路径</td></tr> <tr><td>-q</td> <td>进行过滤</td></tr></tbody></table> <h3 id="_2-1-准备数据-t52-1-准备数据"><a href="#_2-1-准备数据-t52-1-准备数据" aria-hidden="true" class="header-anchor">#</a> 2.1 准备数据 [#](#t52.1 准备数据)</h3> <div class="language-js extra-class"><pre class="language-js"><code>use school<span class="token punctuation">;</span>
<span class="token keyword">var</span> students <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>i<span class="token operator">&lt;=</span><span class="token number">10</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    students<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'zxmf'</span><span class="token operator">+</span>i<span class="token punctuation">,</span>age<span class="token punctuation">:</span>i<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>students<span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_2-2-备份记录-t62-2-备份记录"><a href="#_2-2-备份记录-t62-2-备份记录" aria-hidden="true" class="header-anchor">#</a> 2.2 备份记录 [#](#t62.2 备份记录)</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>mongoexport -h 127.0.0.1 --port 50000  -d school -c students -o stu.bak
</code></pre></div><h3 id="_2-3-删除记录-t72-3-删除记录"><a href="#_2-3-删除记录-t72-3-删除记录" aria-hidden="true" class="header-anchor">#</a> 2.3 删除记录 [#](#t72.3 删除记录)</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> db<span class="token punctuation">.</span>students<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>{}<span class="token punctuation">)</span><span class="token punctuation">;</span>
WriteResult<span class="token punctuation">(</span>{ <span class="token string">&quot;nRemoved&quot;</span> : <span class="token number">10</span> }<span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-4-导入记录-t82-4-导入记录"><a href="#_2-4-导入记录-t82-4-导入记录" aria-hidden="true" class="header-anchor">#</a> 2.4 导入记录 [#](#t82.4 导入记录)</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>mongoimport --port 50000 --db school --collection students --file
stu.bak
</code></pre></div><h2 id="_3-备份与恢复-t93-备份与恢复"><a href="#_3-备份与恢复-t93-备份与恢复" aria-hidden="true" class="header-anchor">#</a> 3. 备份与恢复 [#](#t93. 备份与恢复)</h2> <h3 id="_3-1-mongodump-t103-1-mongodump"><a href="#_3-1-mongodump-t103-1-mongodump" aria-hidden="true" class="header-anchor">#</a> 3.1 mongodump [#](#t103.1 mongodump)</h3> <p>在Mongodb中我们使用mongodump命令来备份MongoDB数据。该命令可以导出所有数据到指定目录中。</p> <blockquote><p>mongodump -h dbhost -d dbname -o dbdirectory</p> <ul><li>-h MongDB所在服务器地址，例如：127.0.0.1，当然也可以指定端口号：127.0.0.1:27017</li> <li>-d 需要备份的数据库实例，例如：test</li> <li>-o 备份的数据存放位置</li></ul></blockquote> <pre><code>mongodump  -d school -o data.dmp
</code></pre> <h3 id="_3-2-mongorestore-t113-2-mongorestore"><a href="#_3-2-mongorestore-t113-2-mongorestore" aria-hidden="true" class="header-anchor">#</a> 3.2 mongorestore [#](#t113.2 mongorestore)</h3> <p>mongodb使用 mongorestore 命令来恢复备份的数据。</p> <ul><li><p>--host MongoDB所在服务器地址</p></li> <li><p>--db -d 需要恢复的数据库实例</p></li> <li><p>最后的一个参数，设置备份数据所在位置</p> <div class="language-bash extra-class"><pre class="language-bash"><code>mongorestore  data.dmp
mongorestore -d school data.bmp/school
</code></pre></div></li></ul> <blockquote><p>Mongodump可以backup整个数据库，而mongoexport要对每个collection进行操作，最主要的区别也是选择的标准是mongoexport输出的JSON比Mongodump的BSON可读性更高，进而可以直接对JSON文件进行操作然后还原数据（BSON转换JSON存在潜在兼容问题）。</p></blockquote> <h2 id="_4-直接拷贝数据-t124-直接拷贝数据"><a href="#_4-直接拷贝数据-t124-直接拷贝数据" aria-hidden="true" class="header-anchor">#</a> 4. 直接拷贝数据 [#](#t124. 直接拷贝数据)</h2> <h2 id="_5-锁定和解锁数据库-t135-锁定和解锁数据库"><a href="#_5-锁定和解锁数据库-t135-锁定和解锁数据库" aria-hidden="true" class="header-anchor">#</a> 5. 锁定和解锁数据库 [#](#t135. 锁定和解锁数据库)</h2> <p>为了数据的完整性和一致性，导出前要先锁定写入，导出后再解锁。</p> <div class="language-sql lite extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">use</span> admin<span class="token punctuation">;</span>
switched <span class="token keyword">to</span> db admin
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{fsync:<span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">lock</span>:<span class="token number">1</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span>
{
        <span class="token string">&quot;info&quot;</span> : <span class="token string">&quot;now locked against writes, use db.fsyncUnlock() to unlock&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;seeAlso&quot;</span> : <span class="token string">&quot;http://dochub.mongodb.org/core/fsynccommand&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;ok&quot;</span> : <span class="token number">1</span>
}
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span>fsyncUnlock<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
{ <span class="token string">&quot;ok&quot;</span> : <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;info&quot;</span> : <span class="token string">&quot;unlock completed&quot;</span> }
</code></pre></div><h2 id="_6-安全措施-t146-安全措施"><a href="#_6-安全措施-t146-安全措施" aria-hidden="true" class="header-anchor">#</a> 6. 安全措施 [#](#t146. 安全措施)</h2> <ul><li>物理隔离</li> <li>网络隔离</li> <li>防火墙(IP/IP段/白名单/黑名单)</li> <li>用户名和密码验证</li></ul> <h3 id="_6-1-用户管理-t156-1-用户管理"><a href="#_6-1-用户管理-t156-1-用户管理" aria-hidden="true" class="header-anchor">#</a> 6.1 用户管理 [#](#t156.1 用户管理)</h3> <h3 id="_6-1-1-查看角色-t166-1-1-查看角色"><a href="#_6-1-1-查看角色-t166-1-1-查看角色" aria-hidden="true" class="header-anchor">#</a> 6.1.1 查看角色 [#](#t166.1.1 查看角色)</h3> <pre><code>show roles;
</code></pre> <p>内置角色</p> <ul><li>数据库用户角色：read、readWrite；</li> <li>数据库管理角色：dbAdmin、dbOwner、userAdmin;</li> <li>集群管理角色：clusterAdmin、clusterManager、clusterMonitor、hostManage；</li> <li>备份恢复角色：backup、restore；</li> <li>所有数据库角色：readAnyDatabase、readWriteAnyDatabase、userAdminAnyDatabase、dbAdminAnyDatabase</li> <li>超级用户角色：root</li> <li>内部角色：__system</li></ul> <h3 id="_6-1-2-老的创建用户的方法-t176-1-2-老的创建用户的方法"><a href="#_6-1-2-老的创建用户的方法-t176-1-2-老的创建用户的方法" aria-hidden="true" class="header-anchor">#</a> 6.1.2 老的创建用户的方法 [#](#t176.1.2 老的创建用户的方法)</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> db<span class="token punctuation">.</span>addUser<span class="token punctuation">(</span><span class="token string">'zxmf'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
WARNING: The <span class="token string">'addUser'</span> shell helper <span class="token operator">is</span> DEPRECATED<span class="token punctuation">.</span> Please <span class="token keyword">use</span> <span class="token string">'createUser'</span> inste
ad
Successfully added <span class="token keyword">user</span>: { <span class="token string">&quot;user&quot;</span> : <span class="token string">&quot;zxmf&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;roles&quot;</span> : <span class="token punctuation">[</span> <span class="token string">&quot;root&quot;</span> <span class="token punctuation">]</span> }
<span class="token keyword">show</span> roles<span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-1-3-新的创建用户的方法-t186-1-3-新的创建用户的方法"><a href="#_6-1-3-新的创建用户的方法-t186-1-3-新的创建用户的方法" aria-hidden="true" class="header-anchor">#</a> 6.1.3 新的创建用户的方法 [#](#t186.1.3 新的创建用户的方法)</h3> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span><span class="token function">createUser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    user<span class="token punctuation">:</span><span class="token string">&quot;zxmf2&quot;</span><span class="token punctuation">,</span>
    pwd<span class="token punctuation">:</span><span class="token string">&quot;123456&quot;</span><span class="token punctuation">,</span>
    roles<span class="token punctuation">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            role<span class="token punctuation">:</span><span class="token string">&quot;readWrite&quot;</span><span class="token punctuation">,</span>
            db<span class="token punctuation">:</span><span class="token string">&quot;school&quot;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token string">'read'</span>
   <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> db<span class="token punctuation">.</span>createUser<span class="token punctuation">(</span>{<span class="token keyword">user</span>:<span class="token string">'zxmf2'</span><span class="token punctuation">,</span>pwd:<span class="token string">'123456'</span><span class="token punctuation">,</span>roles:<span class="token punctuation">[</span>{role:<span class="token string">'read'</span><span class="token punctuation">,</span>db:<span class="token string">'school'</span>}<span class="token punctuation">]</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span>
Successfully added <span class="token keyword">user</span>: {
        <span class="token string">&quot;user&quot;</span> : <span class="token string">&quot;zxmf2&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;roles&quot;</span> : <span class="token punctuation">[</span>
                {
                        <span class="token string">&quot;role&quot;</span> : <span class="token string">&quot;read&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;db&quot;</span> : <span class="token string">&quot;school&quot;</span>
                }
        <span class="token punctuation">]</span>
}
</code></pre></div><h3 id="_6-1-4-查看用户的权限-t196-1-4-查看用户的权限"><a href="#_6-1-4-查看用户的权限-t196-1-4-查看用户的权限" aria-hidden="true" class="header-anchor">#</a> 6.1.4 查看用户的权限 [#](#t196.1.4 查看用户的权限)</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{usersInfo:<span class="token string">'zxmf2'</span><span class="token punctuation">,</span>showPrivileges:<span class="token boolean">true</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span>
{
        <span class="token string">&quot;users&quot;</span> : <span class="token punctuation">[</span>
                {
                        <span class="token string">&quot;_id&quot;</span> : <span class="token string">&quot;admin.zxmf2&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;user&quot;</span> : <span class="token string">&quot;zxmf2&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;db&quot;</span> : <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
                        <span class="token string">&quot;roles&quot;</span> : <span class="token punctuation">[</span>
                                {
                                        <span class="token string">&quot;role&quot;</span> : <span class="token string">&quot;read&quot;</span><span class="token punctuation">,</span>
                                        <span class="token string">&quot;db&quot;</span> : <span class="token string">&quot;school&quot;</span>
                                }
                <span class="token punctuation">]</span>
}
</code></pre></div><h3 id="_6-1-5-服务器启动权限认证-t206-1-5-服务器启动权限认证"><a href="#_6-1-5-服务器启动权限认证-t206-1-5-服务器启动权限认证" aria-hidden="true" class="header-anchor">#</a> 6.1.5 服务器启动权限认证 [#](#t206.1.5 服务器启动权限认证)</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>dbpath<span class="token operator">=</span>E:\mongo\data
logpath<span class="token operator">=</span>E:\mongo\log
port<span class="token operator">=</span>50000
auth<span class="token operator">=</span>true
</code></pre></div><h3 id="_6-1-6-用户登录和修改密码-t216-1-6-用户登录和修改密码"><a href="#_6-1-6-用户登录和修改密码-t216-1-6-用户登录和修改密码" aria-hidden="true" class="header-anchor">#</a> 6.1.6 用户登录和修改密码 [#](#t216.1.6 用户登录和修改密码)</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token operator">&gt;</span> <span class="token keyword">use</span> admin<span class="token punctuation">;</span>
<span class="token operator">&gt;</span> <span class="token keyword">use</span> admin<span class="token punctuation">;</span>
switched <span class="token keyword">to</span> db admin
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span>auth<span class="token punctuation">(</span><span class="token string">'zxmf'</span><span class="token punctuation">,</span><span class="token string">'123456'</span><span class="token punctuation">)</span>
<span class="token number">1</span>
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span>changeUserPassword<span class="token punctuation">(</span><span class="token string">'zxmf'</span><span class="token punctuation">,</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span>auth<span class="token punctuation">(</span><span class="token string">'zxmf'</span><span class="token punctuation">,</span><span class="token string">'123'</span><span class="token punctuation">)</span>
<span class="token number">1</span>
</code></pre></div><h3 id="_6-1-7-修改个人信息-t226-1-7-修改个人信息"><a href="#_6-1-7-修改个人信息-t226-1-7-修改个人信息" aria-hidden="true" class="header-anchor">#</a> 6.1.7 修改个人信息 [#](#t226.1.7 修改个人信息)</h3> <div class="language-sql extra-class"><pre class="language-sql"><code>db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{updateUser:<span class="token string">'zxmf'</span><span class="token punctuation">,</span>pwd:<span class="token string">'123'</span><span class="token punctuation">,</span> customData:{
        name:<span class="token string">'张熙沐枫'</span><span class="token punctuation">,</span>
        email:<span class="token string">'zxmf@126.com'</span><span class="token punctuation">,</span>
        age:<span class="token number">18</span><span class="token punctuation">,</span>
}}<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{usersInfo:<span class="token string">'zxmf'</span><span class="token punctuation">,</span>showPrivileges:<span class="token boolean">true</span>}<span class="token punctuation">)</span>
</code></pre></div><ul><li>用户的操作都需要在admin数据库下面进行操作</li> <li>如果在某个数据库下面执行操作，那么只对当前数据库生效</li> <li>addUser已经废弃，默认会创建root用户，不安全，不再建议使用</li></ul> <h2 id="_7-数据库高级命令-t237-数据库高级命令"><a href="#_7-数据库高级命令-t237-数据库高级命令" aria-hidden="true" class="header-anchor">#</a> 7. 数据库高级命令 [#](#t237. 数据库高级命令)</h2> <h3 id="_7-1-准备数据-t247-1-准备数据"><a href="#_7-1-准备数据-t247-1-准备数据" aria-hidden="true" class="header-anchor">#</a> 7.1 准备数据 [#](#t247.1 准备数据)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> students <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'zxmf1'</span><span class="token punctuation">,</span>home<span class="token punctuation">:</span><span class="token string">'北京'</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'zxmf2'</span><span class="token punctuation">,</span>home<span class="token punctuation">:</span><span class="token string">'北京'</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'zxmf3'</span><span class="token punctuation">,</span>home<span class="token punctuation">:</span><span class="token string">'北京'</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'zxmf4'</span><span class="token punctuation">,</span>home<span class="token punctuation">:</span><span class="token string">'广东'</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'zxmf5'</span><span class="token punctuation">,</span>home<span class="token punctuation">:</span><span class="token string">'广东'</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'zxmf6'</span><span class="token punctuation">,</span>home<span class="token punctuation">:</span><span class="token string">'广东'</span><span class="token punctuation">,</span>age<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span>
<span class="token punctuation">]</span>
db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>students<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-2-count-t257-2-count"><a href="#_7-2-count-t257-2-count" aria-hidden="true" class="header-anchor">#</a> 7.2 count [#](#t257.2 count)</h3> <p>查看记录数</p> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span>students<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-2-查找不重复的值-distinct-t267-2-查找不重复的值-distinct"><a href="#_7-2-查找不重复的值-distinct-t267-2-查找不重复的值-distinct" aria-hidden="true" class="header-anchor">#</a> 7.2 查找不重复的值 distinct [#](#t267.2 查找不重复的值 distinct)</h3> <div class="language-js extra-class"><pre class="language-js"><code>db<span class="token punctuation">.</span><span class="token function">runCommand</span><span class="token punctuation">(</span><span class="token punctuation">{</span>distinct<span class="token punctuation">:</span><span class="token string">'students'</span><span class="token punctuation">,</span>key<span class="token punctuation">:</span><span class="token string">'home'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">;</span>

<span class="token punctuation">[</span> <span class="token string">&quot;北京&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;广东&quot;</span> <span class="token punctuation">]</span>
</code></pre></div><h3 id="_7-3-group-分组-t277-3-group-分组"><a href="#_7-3-group-分组-t277-3-group-分组" aria-hidden="true" class="header-anchor">#</a> 7.3 group 分组 [#](#t277.3  group 分组)</h3> <div class="language-sql extra-class"><pre class="language-sql"><code>db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{
        <span class="token keyword">group</span>:{
                ns:集合名称，
                <span class="token keyword">key</span>:分组的键<span class="token punctuation">,</span>
                initial:初始值<span class="token punctuation">,</span>
                $reduce:分解器
                condition:条件<span class="token punctuation">,</span>
                finalize:完成时的处理器
        }
}<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_7-3-1-按城市分组，求每个城市里符合条件的人的年龄总和-t287-3-1-按城市分组，求每个城市里符合条件的人的年龄总和"><a href="#_7-3-1-按城市分组，求每个城市里符合条件的人的年龄总和-t287-3-1-按城市分组，求每个城市里符合条件的人的年龄总和" aria-hidden="true" class="header-anchor">#</a> 7.3.1 按城市分组，求每个城市里符合条件的人的年龄总和 [#](#t287.3.1 按城市分组，求每个城市里符合条件的人的年龄总和)</h4> <div class="language-sql extra-class"><pre class="language-sql"><code>db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{
        <span class="token keyword">group</span>:{
                ns:<span class="token string">'students'</span><span class="token punctuation">,</span>
                <span class="token keyword">key</span>:{home:<span class="token boolean">true</span>}<span class="token punctuation">,</span>
                initial:{total:<span class="token number">0</span>}<span class="token punctuation">,</span>
                $reduce:<span class="token keyword">function</span><span class="token punctuation">(</span>doc<span class="token punctuation">,</span>result<span class="token punctuation">)</span>{
                      result<span class="token punctuation">.</span>total <span class="token operator">+</span><span class="token operator">=</span> doc<span class="token punctuation">.</span>age<span class="token punctuation">;</span>
                }<span class="token punctuation">,</span>
                condition:{age:{$gt:<span class="token number">1</span>}}<span class="token punctuation">,</span>
                finalize:<span class="token keyword">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>{
                    result<span class="token punctuation">.</span><span class="token keyword">desc</span> <span class="token operator">=</span> <span class="token string">'本城市的总年龄为'</span><span class="token operator">+</span>result<span class="token punctuation">.</span>total<span class="token punctuation">;</span>
                }
        }
}<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_7-4-删除集合-t297-4-删除集合"><a href="#_7-4-删除集合-t297-4-删除集合" aria-hidden="true" class="header-anchor">#</a> 7.4 删除集合 [#](#t297.4 删除集合)</h4> <div class="language-sql extra-class"><pre class="language-sql"><code>db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{<span class="token keyword">drop</span>:<span class="token string">'students'</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_7-5-runcommand常用命令-t307-5-runcommand常用命令"><a href="#_7-5-runcommand常用命令-t307-5-runcommand常用命令" aria-hidden="true" class="header-anchor">#</a> 7.5 runCommand常用命令 [#](#t307.5 runCommand常用命令)</h4> <div class="language-sql extra-class"><pre class="language-sql"><code>db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{buildInfo:<span class="token number">1</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{getLastError:<span class="token string">&quot;students&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>persons<span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span>{_id:<span class="token number">1</span><span class="token punctuation">,</span>name:<span class="token number">1</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>persons<span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span>{_id:<span class="token number">1</span><span class="token punctuation">,</span>name:<span class="token number">1</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{getLastError:<span class="token string">&quot;students&quot;</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_8-什么固定集合-t318-什么固定集合"><a href="#_8-什么固定集合-t318-什么固定集合" aria-hidden="true" class="header-anchor">#</a> 8. 什么固定集合 [#](#t318. 什么固定集合)</h2> <p>MongoDB 固定集合（Capped Collections）是性能出色且有着固定大小的集合，对于大小固定，我们可以想象其就像一个环形队列，当集合空间用完后，再插入的元素就会覆盖最初始的头部的元素！ <img src="assets/firstinfirstout.png" alt="firstinfirstout"></p> <h3 id="_8-1-特性-t328-1-特性"><a href="#_8-1-特性-t328-1-特性" aria-hidden="true" class="header-anchor">#</a> 8.1 特性 [#](#t328.1 特性)</h3> <ul><li><ol><li>没有索引</li></ol></li> <li><ol><li>插入和查询速度速度非常快 不需要重新分配空间</li></ol></li> <li><ol><li>特别适合存储日志</li></ol></li></ul> <h3 id="_8-2-创建固定集合-t338-2-创建固定集合"><a href="#_8-2-创建固定集合-t338-2-创建固定集合" aria-hidden="true" class="header-anchor">#</a> 8.2 创建固定集合 [#](#t338.2 创建固定集合)</h3> <ul><li><p>我们通过createCollection来创建一个固定集合，且capped选项设置为true：</p></li> <li><p>还可以指定文档个数,加上max:1000属性：</p></li> <li><p>判断集合是否为固定集合: db.logs.isCapped()</p></li> <li><p>size 是整个集合空间大小，单位为【KB】</p></li> <li><p>max 是集合文档个数上线，单位是【个】</p></li> <li><p>如果空间大小到达上限，则插入下一个文档时，会覆盖第一个文档；如果文档个数到达上限，同样插入下一个文档时，会覆盖第一个文档。两个参数上限判断取的是【与】的逻辑。</p></li> <li><p>capped 封顶的</p> <div class="language-sql extra-class"><pre class="language-sql"><code> db<span class="token punctuation">.</span>createCollection<span class="token punctuation">(</span><span class="token string">'logs'</span><span class="token punctuation">,</span>{size:<span class="token number">50</span><span class="token punctuation">,</span>max:<span class="token number">5</span><span class="token punctuation">,</span>capped:<span class="token boolean">true</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h3 id="_8-3-非固定集合转为固定集合-t348-3-非固定集合转为固定集合"><a href="#_8-3-非固定集合转为固定集合-t348-3-非固定集合转为固定集合" aria-hidden="true" class="header-anchor">#</a> 8.3 非固定集合转为固定集合 [#](#t348.3 非固定集合转为固定集合)</h3> <div class="language-sql extra-class"><pre class="language-sql"><code>db<span class="token punctuation">.</span>runCommand<span class="token punctuation">(</span>{convertToCapped:<span class="token string">&quot;logs&quot;</span><span class="token punctuation">,</span>size:<span class="token number">5</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_9-gridfs-t359-gridfs"><a href="#_9-gridfs-t359-gridfs" aria-hidden="true" class="header-anchor">#</a> 9. gridfs [#](#t359. gridfs)</h2> <ul><li><p>gridfs是mongodb自带的文件系统，使用二进制存储文件。</p></li> <li><p>mongodb可以以BSON格式保存二进制对象。</p></li> <li><p>但是BSON对象的体积不能超过4M。所以mongodb提供了<code>mongofiles</code>。它可以把一个大文件透明地分割成小文件（256K），从而保存大体积的数据。</p></li> <li><p>GridFS 用于存储和恢复那些超过16M（BSON文件限制）的文件(如：图片、音频、视频等)。</p></li> <li><p>GridFS 用两个集合来存储一个文件：fs.files与fs.chunks。</p></li> <li><p>每个文件的实际内容被存在chunks(二进制数据)中,和文件有关的meta数据(filename,content_type,还有用户自定义的属性)将会被存在files集合中。</p></li> <li><h3 id="_9-1-上传一个文件-t369-1-上传一个文件"><a href="#_9-1-上传一个文件-t369-1-上传一个文件" aria-hidden="true" class="header-anchor">#</a> 9.1 上传一个文件 [#](#t369.1  上传一个文件)</h3></li> <li><p>-d 数据库的名称</p></li> <li><p>-l 源文件的位置</p></li> <li><p>put 指定文件名</p> <div class="language-bash extra-class"><pre class="language-bash"><code>mongofiles -d myfiles put test.txt
</code></pre></div></li></ul> <h3 id="_9-2-获取并下载文件-t379-2-获取并下载文件"><a href="#_9-2-获取并下载文件-t379-2-获取并下载文件" aria-hidden="true" class="header-anchor">#</a> 9.2 获取并下载文件 [#](#t379.2  获取并下载文件)</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>mongofiles -d myfiles  get <span class="token string">'test.txt'</span>
</code></pre></div><h3 id="_9-3-查看所有文件-t389-3-查看所有文件"><a href="#_9-3-查看所有文件-t389-3-查看所有文件" aria-hidden="true" class="header-anchor">#</a> 9.3 查看所有文件 [#](#t389.3  查看所有文件)</h3> <div class="language-sql extra-class"><pre class="language-sql"><code>mongofiles <span class="token operator">-</span>d myfiles  list
<span class="token operator">&gt;</span>db<span class="token punctuation">.</span>fs<span class="token punctuation">.</span>files<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span>db<span class="token punctuation">.</span>fs<span class="token punctuation">.</span>chunks<span class="token punctuation">.</span>find<span class="token punctuation">(</span>{files_id:ObjectId<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>}<span class="token punctuation">)</span>
</code></pre></div><h3 id="_9-4-删除文件-t399-4-删除文件"><a href="#_9-4-删除文件-t399-4-删除文件" aria-hidden="true" class="header-anchor">#</a> 9.4 删除文件 [#](#t399.4  删除文件)</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>mongofiles -d myfiles delete <span class="token string">&quot;test.txt&quot;</span>
</code></pre></div><h3 id="_9-5-eval-服务器端脚本-t409-5-eval-服务器端脚本"><a href="#_9-5-eval-服务器端脚本-t409-5-eval-服务器端脚本" aria-hidden="true" class="header-anchor">#</a> 9.5 eval 服务器端脚本 [#](#t409.5  eval 服务器端脚本)</h3> <ul><li><p>执行JS语句</p></li> <li><p>定义JS全局变量</p></li> <li><p>定义函数</p></li> <li><p>Stored JavaScript</p> <div class="language-sql extra-class"><pre class="language-sql"><code>db<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token string">&quot;1+1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token string">&quot;return 'hello'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>system<span class="token punctuation">.</span>js<span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span>{_id:<span class="token string">&quot;x&quot;</span><span class="token punctuation">,</span><span class="token keyword">value</span>:<span class="token number">1</span>}<span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token string">&quot;return x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>system<span class="token punctuation">.</span>js<span class="token punctuation">.</span><span class="token keyword">insert</span><span class="token punctuation">(</span>{_id:<span class="token string">&quot;say&quot;</span><span class="token punctuation">,</span><span class="token keyword">value</span>:<span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>{<span class="token keyword">return</span> <span class="token string">'hello'</span>}}<span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>eval<span class="token punctuation">(</span><span class="token string">&quot;say()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul></div> <!----> <div class="content page-nav"><p class="inner"><span class="prev">
          ← <a href="/fe/29.mongodb-6.html" class="prev">
            扩展mongoose模型
          </a></span> <span class="next"><a href="/fe/30.cms-1-mysql.html">
            数据库能够做什么 #
          </a> →
        </span></p></div> <div id="comment-container"><div class="gt-container"><div class="gt-initing"><i class="gt-loader"></i> <p class="gt-initing-text">Gitalking ...</p></div> <!----> <!----> <div><div class="gt-header"><a class="gt-avatar-github"><span class="gt-ico gt-ico-github"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64 524C64 719.602 189.356 885.926 364.113 947.017 387.65799 953 384 936.115 384 924.767L384 847.107C248.118 863.007 242.674 773.052 233.5 758.001 215 726.501 171.5 718.501 184.5 703.501 215.5 687.501 247 707.501 283.5 761.501 309.956 800.642 361.366 794.075 387.658 787.497 393.403 763.997 405.637 743.042 422.353 726.638 281.774 701.609 223 615.67 223 513.5 223 464.053 239.322 418.406 271.465 381.627 251.142 320.928 273.421 269.19 276.337 261.415 334.458 256.131 394.888 302.993 399.549 306.685 432.663 297.835 470.341 293 512.5 293 554.924 293 592.81 297.896 626.075 306.853 637.426 298.219 693.46 258.054 747.5 262.966 750.382 270.652 772.185 321.292 753.058 381.083 785.516 417.956 802 463.809 802 513.5 802 615.874 742.99 701.953 601.803 726.786 625.381 750.003 640 782.295 640 818.008L640 930.653C640.752 939.626 640 948.664978 655.086 948.665 832.344 888.962 960 721.389 960 524 960 276.576 759.424 76 512 76 264.577 76 64 276.576 64 524Z"></path>
</svg>
</span> <!----></span></a> <div class="gt-header-comment"><textarea placeholder="Leave a comment" class="gt-header-textarea"></textarea> <div class="gt-header-preview markdown-body hide"></div> <div class="gt-header-controls"><a href="https://guides.github.com/features/mastering-markdown/" target="_blank" class="gt-header-controls-tip"><span class="gt-ico gt-ico-tip"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 366.949535c-16.065554 0-29.982212 13.405016-29.982212 29.879884l0 359.070251c0 16.167882 13.405016 29.879884 29.982212 29.879884 15.963226 0 29.879884-13.405016 29.879884-29.879884L541.879884 396.829419C541.879884 380.763865 528.474868 366.949535 512 366.949535L512 366.949535z"
    p-id="3083"></path>
  <path d="M482.017788 287.645048c0-7.776956 3.274508-15.553912 8.80024-21.181973 5.525732-5.525732 13.302688-8.80024 21.181973-8.80024 7.776956 0 15.553912 3.274508 21.079644 8.80024 5.525732 5.62806 8.80024 13.405016 8.80024 21.181973 0 7.776956-3.274508 15.656241-8.80024 21.181973-5.525732 5.525732-13.405016 8.697911-21.079644 8.697911-7.879285 0-15.656241-3.274508-21.181973-8.697911C485.292295 303.301289 482.017788 295.524333 482.017788 287.645048L482.017788 287.645048z"
    p-id="3084"></path>
  <path d="M512 946.844409c-239.8577 0-434.895573-195.037873-434.895573-434.895573 0-239.8577 195.037873-434.895573 434.895573-434.895573 239.755371 0 434.895573 195.037873 434.895573 434.895573C946.895573 751.806535 751.755371 946.844409 512 946.844409zM512 126.17088c-212.740682 0-385.880284 173.037274-385.880284 385.777955 0 212.740682 173.037274 385.777955 385.880284 385.777955 212.740682 0 385.777955-173.037274 385.777955-385.777955C897.777955 299.208154 724.740682 126.17088 512 126.17088z"
    p-id="3085"></path>
</svg>
</span> <span class="gt-ico-text">Markdown is supported</span></span></a> <!----> <button class="gt-btn gt-btn-preview"><span class="gt-btn-text">Preview</span> <!----></button> <button class="gt-btn gt-btn-login"><span class="gt-btn-text">Login with GitHub</span> <!----></button></div></div></div> <div class="gt-comments"><span></span> <p class="gt-comments-null">
                Be the first guy leaving a comment!
            </p> <!----></div></div></div></div></div></div> <!----></div> <div class="tool-group"><!----></div></div> <!----></div> <div class="background-mask" style="background:#f6f6f6;"></div></div></div>
    <script src="/assets/js/app.35b69267.js" defer></script><script src="/assets/js/61.a5c3f820.js" defer></script>
  </body>
</html>
