<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>loader源码 | Myfun&#39;s Blog</title>
    <meta name="description" content="webpack">
    <link rel="icon" href="/favicon.ico">
    <meta name="keywords" content="webpack">
    <link rel="preload" href="/assets/css/0.styles.6bc9bf16.css" as="style"><link rel="preload" href="/assets/js/app.35b69267.js" as="script"><link rel="preload" href="/assets/js/43.b385d348.js" as="script"><link rel="prefetch" href="/assets/js/10.a2f6c6ac.js"><link rel="prefetch" href="/assets/js/100.24b9a366.js"><link rel="prefetch" href="/assets/js/101.085f0585.js"><link rel="prefetch" href="/assets/js/102.66d5674f.js"><link rel="prefetch" href="/assets/js/103.7f71429c.js"><link rel="prefetch" href="/assets/js/104.13b0f535.js"><link rel="prefetch" href="/assets/js/105.0a093e85.js"><link rel="prefetch" href="/assets/js/106.a4a1db62.js"><link rel="prefetch" href="/assets/js/107.2634aacf.js"><link rel="prefetch" href="/assets/js/108.b393516d.js"><link rel="prefetch" href="/assets/js/109.769b78fb.js"><link rel="prefetch" href="/assets/js/11.fb483cc4.js"><link rel="prefetch" href="/assets/js/12.24a41994.js"><link rel="prefetch" href="/assets/js/13.a4762474.js"><link rel="prefetch" href="/assets/js/14.4a737bc9.js"><link rel="prefetch" href="/assets/js/15.548f4e99.js"><link rel="prefetch" href="/assets/js/16.b0d2654c.js"><link rel="prefetch" href="/assets/js/17.d43ab467.js"><link rel="prefetch" href="/assets/js/18.0c8f5f87.js"><link rel="prefetch" href="/assets/js/19.19ef59f8.js"><link rel="prefetch" href="/assets/js/2.436a35aa.js"><link rel="prefetch" href="/assets/js/20.24296203.js"><link rel="prefetch" href="/assets/js/21.c486888f.js"><link rel="prefetch" href="/assets/js/22.7e2305f9.js"><link rel="prefetch" href="/assets/js/23.e55bab1b.js"><link rel="prefetch" href="/assets/js/24.1468433c.js"><link rel="prefetch" href="/assets/js/25.6d82837f.js"><link rel="prefetch" href="/assets/js/26.3c4b2f18.js"><link rel="prefetch" href="/assets/js/27.21725a4f.js"><link rel="prefetch" href="/assets/js/28.db16c479.js"><link rel="prefetch" href="/assets/js/29.cb9512e5.js"><link rel="prefetch" href="/assets/js/3.5c82c0f7.js"><link rel="prefetch" href="/assets/js/30.a4c25096.js"><link rel="prefetch" href="/assets/js/31.81741530.js"><link rel="prefetch" href="/assets/js/32.da6d2ac6.js"><link rel="prefetch" href="/assets/js/33.f6164ecd.js"><link rel="prefetch" href="/assets/js/34.0344ad22.js"><link rel="prefetch" href="/assets/js/35.07d4c8d3.js"><link rel="prefetch" href="/assets/js/36.2c6adcff.js"><link rel="prefetch" href="/assets/js/37.ceb5e95e.js"><link rel="prefetch" href="/assets/js/38.d39e96e5.js"><link rel="prefetch" href="/assets/js/39.fcf34164.js"><link rel="prefetch" href="/assets/js/4.267db630.js"><link rel="prefetch" href="/assets/js/40.bdf31768.js"><link rel="prefetch" href="/assets/js/41.cc61eccd.js"><link rel="prefetch" href="/assets/js/42.042e4349.js"><link rel="prefetch" href="/assets/js/44.7669f3e2.js"><link rel="prefetch" href="/assets/js/45.2fb532f4.js"><link rel="prefetch" href="/assets/js/46.0cc86442.js"><link rel="prefetch" href="/assets/js/47.30448b83.js"><link rel="prefetch" href="/assets/js/48.8893a5ed.js"><link rel="prefetch" href="/assets/js/49.ed7be1ae.js"><link rel="prefetch" href="/assets/js/5.d8a5933e.js"><link rel="prefetch" href="/assets/js/50.e4af394b.js"><link rel="prefetch" href="/assets/js/51.502ca2a7.js"><link rel="prefetch" href="/assets/js/52.f9768ea6.js"><link rel="prefetch" href="/assets/js/53.0c762369.js"><link rel="prefetch" href="/assets/js/54.dad23d00.js"><link rel="prefetch" href="/assets/js/55.4298d6a4.js"><link rel="prefetch" href="/assets/js/56.d8505fa7.js"><link rel="prefetch" href="/assets/js/57.63d197ce.js"><link rel="prefetch" href="/assets/js/58.ae9a3671.js"><link rel="prefetch" href="/assets/js/59.cb04d7cd.js"><link rel="prefetch" href="/assets/js/6.a83fef9a.js"><link rel="prefetch" href="/assets/js/60.0cedb385.js"><link rel="prefetch" href="/assets/js/61.a5c3f820.js"><link rel="prefetch" href="/assets/js/62.fc2d969d.js"><link rel="prefetch" href="/assets/js/63.53f087e3.js"><link rel="prefetch" href="/assets/js/64.9384bc9a.js"><link rel="prefetch" href="/assets/js/65.bb5db767.js"><link rel="prefetch" href="/assets/js/66.86940f42.js"><link rel="prefetch" href="/assets/js/67.37215862.js"><link rel="prefetch" href="/assets/js/68.e0c14875.js"><link rel="prefetch" href="/assets/js/69.276f0d65.js"><link rel="prefetch" href="/assets/js/7.7e7cde5e.js"><link rel="prefetch" href="/assets/js/70.0fb38ae4.js"><link rel="prefetch" href="/assets/js/71.7c824b27.js"><link rel="prefetch" href="/assets/js/72.bc39810c.js"><link rel="prefetch" href="/assets/js/73.9917d9a4.js"><link rel="prefetch" href="/assets/js/74.7912f7da.js"><link rel="prefetch" href="/assets/js/75.c193b7ec.js"><link rel="prefetch" href="/assets/js/76.ecd4e536.js"><link rel="prefetch" href="/assets/js/77.842c5aba.js"><link rel="prefetch" href="/assets/js/78.0a67366d.js"><link rel="prefetch" href="/assets/js/79.324df7d4.js"><link rel="prefetch" href="/assets/js/8.7063c274.js"><link rel="prefetch" href="/assets/js/80.68c6326b.js"><link rel="prefetch" href="/assets/js/81.a7df7b21.js"><link rel="prefetch" href="/assets/js/82.abd9c0c2.js"><link rel="prefetch" href="/assets/js/83.fd0d8457.js"><link rel="prefetch" href="/assets/js/84.148b432c.js"><link rel="prefetch" href="/assets/js/85.32148693.js"><link rel="prefetch" href="/assets/js/86.7dc5fe11.js"><link rel="prefetch" href="/assets/js/87.bd1be392.js"><link rel="prefetch" href="/assets/js/88.2c0b86aa.js"><link rel="prefetch" href="/assets/js/89.3038cc8d.js"><link rel="prefetch" href="/assets/js/9.5cab2997.js"><link rel="prefetch" href="/assets/js/90.fb4057a1.js"><link rel="prefetch" href="/assets/js/91.4aa5adaf.js"><link rel="prefetch" href="/assets/js/92.aea0a62e.js"><link rel="prefetch" href="/assets/js/93.e2d0e9a7.js"><link rel="prefetch" href="/assets/js/94.a9e33a20.js"><link rel="prefetch" href="/assets/js/95.7c55098e.js"><link rel="prefetch" href="/assets/js/96.c8dfe1c0.js"><link rel="prefetch" href="/assets/js/97.35fc7df3.js"><link rel="prefetch" href="/assets/js/98.551b3ede.js"><link rel="prefetch" href="/assets/js/99.a8f5ffc4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.6bc9bf16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="wrap"><div class="theme-container container no-sidebar"><header class="navbar"><div class="nav-header"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" class="logo"> <span class="site-name can-hide">
        Myfun's Blog
      </span></a> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/interview/" class="nav-link">InterviewMap</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/css_tricks/" target="_blank" rel="noopener noreferrer" class="nav-link">CSS_Tricks</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/js_tricks/" target="_blank" rel="noopener noreferrer" class="nav-link">JS_Tricks</a></div><div class="nav-item"><a href="/tags/" class="nav-link">Tags</a></div><div class="nav-item"><a href="https://github.com/zhangximufeng" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/animate_resume_ts/" target="_blank" rel="noopener noreferrer" class="nav-link">About</a></div> <!----></nav> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/interview/" class="nav-link">InterviewMap</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/css_tricks/" target="_blank" rel="noopener noreferrer" class="nav-link">CSS_Tricks</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/js_tricks/" target="_blank" rel="noopener noreferrer" class="nav-link">JS_Tricks</a></div><div class="nav-item"><a href="/tags/" class="nav-link">Tags</a></div><div class="nav-item"><a href="https://github.com/zhangximufeng" target="_blank" rel="noopener noreferrer" class="nav-link">Github</a></div><div class="nav-item"><a href="https://zhangximufeng.github.io/animate_resume_ts/" target="_blank" rel="noopener noreferrer" class="nav-link">About</a></div> <!----></nav> <!----></div> <div class="page-container"><div><div class="page card"><div class="content-header"><!----> <span class="page-timestamp">2018-09-29</span></div> <div class="content"><p></p><div class="table-of-contents"><ul><li><a href="#loader源码">loader源码</a><ul><li><a href="#_1-6-pitch-t61-6-pitch">1.6 pitch #</a></li><li><a href="#_2-loader配置-t72-loader配置">2\. loader配置 #</a></li><li><a href="#_3-loader用法-t113-loader用法">3\. loader用法 #</a></li><li><a href="#_4-用法准则-t154-用法准则">4 用法准则 #</a></li><li><a href="#_5-api-t255-api">5\. API #</a></li><li><a href="#_6-loader实战-t356-loader实战">6.loader实战 #</a></li><li><a href="#_7-loader测试-t507-loader测试">7.loader测试 #</a></li></ul></li></ul></div><p></p> <h1 id="loader源码"><a href="#loader源码" aria-hidden="true" class="header-anchor">#</a> loader源码</h1> <hr> <p>loader是用来加载处理各种形式的资源,本质上是一个函数, 接受文件作为参数,返回转化后的结构。</p> <ul><li>loader 用于对模块的源代码进行转换</li> <li>loader 可以使你在 import 或&quot;加载&quot;模块时预处理文件</li></ul> <h3 id="_1-1-loader核心代码-t11-1-loader核心代码"><a href="#_1-1-loader核心代码-t11-1-loader核心代码" aria-hidden="true" class="header-anchor">#</a> 1.1 loader核心代码 [#](#t11.1 loader核心代码)</h3> <p>webpack/lib/NormalModule.js:263</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">runLoaders</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
                resource<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">,</span>
                loaders<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">,</span>
                context<span class="token punctuation">:</span> loaderContext
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
<span class="token keyword">const</span> resourceBuffer <span class="token operator">=</span> result<span class="token punctuation">.</span>resourceBuffer<span class="token punctuation">;</span>
<span class="token keyword">const</span> source <span class="token operator">=</span> result<span class="token punctuation">.</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sourceMap <span class="token operator">=</span> result<span class="token punctuation">.</span>result<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">?</span> result<span class="token punctuation">.</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> extraInfo <span class="token operator">=</span> result<span class="token punctuation">.</span>result<span class="token punctuation">.</span>length <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">?</span> result<span class="token punctuation">.</span>result<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token comment">//ast</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>_source <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createSource</span><span class="token punctuation">(</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span>binary <span class="token operator">?</span> <span class="token function">asBuffer</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">:</span> <span class="token function">asString</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">,</span>
                    resourceBuffer<span class="token punctuation">,</span>
                    sourceMap
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>_ast <span class="token operator">=</span> <span class="token keyword">typeof</span> extraInfo <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span>
                    extraInfo <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
                    extraInfo<span class="token punctuation">.</span>webpackAST <span class="token operator">!==</span> undefined<span class="token operator">?</span> extraInfo<span class="token punctuation">.</span>webpackAST<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-2-loaderrunner-js-t21-2-loaderrunner-js"><a href="#_1-2-loaderrunner-js-t21-2-loaderrunner-js" aria-hidden="true" class="header-anchor">#</a> 1.2 LoaderRunner.js [#](#t21.2 LoaderRunner.js)</h3> <p>loader-runner/lib/LoaderRunner.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">iteratePitchingLoaders</span><span class="token punctuation">(</span>processOptions<span class="token punctuation">,</span> loaderContext<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
            result<span class="token punctuation">:</span> result<span class="token punctuation">,</span><span class="token comment">//结果</span>
            resourceBuffer<span class="token punctuation">:</span> processOptions<span class="token punctuation">.</span>resourceBuffer<span class="token punctuation">,</span>
            cacheable<span class="token punctuation">:</span> requestCacheable<span class="token punctuation">,</span>
            fileDependencies<span class="token punctuation">:</span> fileDependencies<span class="token punctuation">,</span>
            contextDependencies<span class="token punctuation">:</span> contextDependencies
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-3-loaderrunner-js-155-t31-3-loaderrunner-js-155"><a href="#_1-3-loaderrunner-js-155-t31-3-loaderrunner-js-155" aria-hidden="true" class="header-anchor">#</a> 1.3 LoaderRunner.js:155 [#](#t31.3 LoaderRunner.js:155)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">if</span><span class="token punctuation">(</span>loaderContext<span class="token punctuation">.</span>loaderIndex <span class="token operator">&gt;=</span> loaderContext<span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">processResource</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> loaderContext<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> fn <span class="token operator">=</span> currentLoaderObject<span class="token punctuation">.</span>pitch<span class="token punctuation">;</span>
<span class="token function">runSyncOrAsync</span><span class="token punctuation">(</span>
            fn<span class="token punctuation">,</span>
            loaderContext<span class="token punctuation">,</span> <span class="token punctuation">[</span>loaderContext<span class="token punctuation">.</span>remainingRequest<span class="token punctuation">,</span> loaderContext<span class="token punctuation">.</span>previousRequest<span class="token punctuation">,</span> currentLoaderObject<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">runSyncOrAsync</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> context<span class="token punctuation">,</span> args<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token keyword">var</span> isSync <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
context<span class="token punctuation">.</span><span class="token function-variable function">async</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    isSync <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> innerCallback<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> innerCallback <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function-variable function">callback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        isSync <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        callback<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token constant">LOADER_EXECUTION</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> fn<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>isSync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-4-loadloader-js-13-t41-4-loadloader-js-13"><a href="#_1-4-loadloader-js-13-t41-4-loadloader-js-13" aria-hidden="true" class="header-anchor">#</a> 1.4 loadLoader.js:13 [#](#t41.4 loadLoader.js:13)</h3> <p>loader-runner/lib/loadLoader.js:13</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>loader<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
loader<span class="token punctuation">.</span>normal <span class="token operator">=</span> <span class="token keyword">typeof</span> module <span class="token operator">===</span> <span class="token string">&quot;function&quot;</span> <span class="token operator">?</span> module <span class="token punctuation">:</span> module<span class="token punctuation">.</span><span class="token keyword">default</span><span class="token punctuation">;</span>
loader<span class="token punctuation">.</span>pitch <span class="token operator">=</span> module<span class="token punctuation">.</span>pitch<span class="token punctuation">;</span>
loader<span class="token punctuation">.</span>raw <span class="token operator">=</span> module<span class="token punctuation">.</span>raw<span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-5-loaderrunner-js-t51-5-loaderrunner-js"><a href="#_1-5-loaderrunner-js-t51-5-loaderrunner-js" aria-hidden="true" class="header-anchor">#</a> 1.5 LoaderRunner.js [#](#t51.5 LoaderRunner.js)</h3> <p>loader-runner/lib/LoaderRunner.js</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">runSyncOrAsync</span><span class="token punctuation">(</span>
            fn<span class="token punctuation">,</span>
            loaderContext<span class="token punctuation">,</span> <span class="token punctuation">[</span>loaderContext<span class="token punctuation">.</span>remainingRequest<span class="token punctuation">,</span> loaderContext<span class="token punctuation">.</span>previousRequest<span class="token punctuation">,</span> currentLoaderObject<span class="token punctuation">.</span>data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">var</span> args <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    loaderContext<span class="token punctuation">.</span>loaderIndex<span class="token operator">--</span><span class="token punctuation">;</span>
                    <span class="token function">iterateNormalLoaders</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> loaderContext<span class="token punctuation">,</span> args<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token function">iteratePitchingLoaders</span><span class="token punctuation">(</span>options<span class="token punctuation">,</span> loaderContext<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_1-6-pitch-t61-6-pitch"><a href="#_1-6-pitch-t61-6-pitch" aria-hidden="true" class="header-anchor">#</a> 1.6 pitch [#](#t61.6 pitch)</h2> <blockquote><p>The loaders are called from right to left. But in some cases loaders do not care about the results of the previous loader or the resource. They only care for metadata. The pitch method on the loaders is called from left to right before the loaders are called. If a loader delivers a result in the pitch method the process turns around and skips the remaining loaders, continuing with the calls to the more left loaders. data can be passed between pitch and normal call.</p> <p>In the complex case, when multiple loaders are chained, only the last loader gets the resource file and only the first loader is expected to give back one or two values (JavaScript and SourceMap). Values that any other loader give back are passed to the previous loader.</p></blockquote> <h2 id="_2-loader配置-t72-loader配置"><a href="#_2-loader配置-t72-loader配置" aria-hidden="true" class="header-anchor">#</a> 2. loader配置 [#](#t72. loader配置)</h2> <p><code>loader</code>是导出为一个函数的<code>node</code>模块。该函数在<code>loader</code>转换资源的时候调用。给定的函数将调用<code>loader API</code>，并通过<code>this</code>上下文访问。</p> <h3 id="_2-1-匹配-test-单个-loader-t82-1-匹配-test-单个-loader"><a href="#_2-1-匹配-test-单个-loader-t82-1-匹配-test-单个-loader" aria-hidden="true" class="header-anchor">#</a> 2.1 匹配(test)单个 loader [#](#t82.1 匹配(test)单个 loader)</h3> <p>匹配(test)单个 loader，你可以简单通过在 rule 对象设置 path.resolve 指向这个本地文件</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.js$/</span>
  use<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'path/to/loader.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_2-2-匹配-test-多个-loaders-t92-2-匹配-test-多个-loaders"><a href="#_2-2-匹配-test-多个-loaders-t92-2-匹配-test-多个-loaders" aria-hidden="true" class="header-anchor">#</a> 2.2 匹配(test)多个 loaders [#](#t92.2 匹配(test)多个 loaders)</h3> <p>你可以使用 resolveLoader.modules 配置，webpack 将会从这些目录中搜索这些 loaders。</p> <div class="language-js extra-class"><pre class="language-js"><code>resolveLoader<span class="token punctuation">:</span> <span class="token punctuation">{</span>
   modules<span class="token punctuation">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 							        	 path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">,</span> <span class="token string">'loaders'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="_2-1-3-npm-link-t102-1-3-npm-link"><a href="#_2-1-3-npm-link-t102-1-3-npm-link" aria-hidden="true" class="header-anchor">#</a> 2.1 3 npm link [#](#t102.1 3 npm link)</h3> <ul><li><p>确保正在开发的本地 Npm 模块（也就是正在开发的 Loader）的 package.json 已经正确配置好； 在本地 Npm 模块根目录下执行 npm link，把本地模块注册到全局；</p></li> <li><p>在项目根目录下执行 npm link loader-name，把第2步注册到全局的本地 Npm 模块链接到项目的 node_moduels 下，其中的 - loader-name 是指在第1步中的 package.json 文件中配置的模块名称。</p> <pre><code>npm link
</code></pre></li></ul> <h2 id="_3-loader用法-t113-loader用法"><a href="#_3-loader用法-t113-loader用法" aria-hidden="true" class="header-anchor">#</a> 3. loader用法 [#](#t113. loader用法)</h2> <h3 id="_3-1-单个loader用法-t123-1-单个loader用法"><a href="#_3-1-单个loader用法-t123-1-单个loader用法" aria-hidden="true" class="header-anchor">#</a> 3.1 单个loader用法 [#](#t123.1 单个loader用法)</h3> <ul><li><p>当一个 loader 在资源中使用，这个 loader 只能传入一个参数 - 这个参数是一个包含包含资源文件内容的字符串</p></li> <li><p>同步 loader 可以简单的返回一个代表模块转化后的值。</p></li> <li><p>在更复杂的情况下，loader 也可以通过使用 this.callback(err, values...) 函数，返回任意数量的值。错误要么传递给这个 this.callback 函数，要么扔进同步 loader 中。</p></li> <li><p>loader只能传入一个包含包含资源文件内容的字符串</p></li> <li><p>同步 loader 可以简单的返回一个代表模块转化后的值</p></li> <li><p>loader 也可以通过使用 this.callback(err, values...) 函数，返回任意数量的值</p></li> <li><p>loader 会返回一个或者两个值。第一个值的类型是 JavaScript 代码的字符串或者 buffer。第二个参数值是 SourceMap，它是个 JavaScript 对象</p></li> <li><p>loader 会返回一个或者两个值。第一个值的类型是 JavaScript 代码的字符串或者 buffer。第二个参数值是 SourceMap，它是个 JavaScript 对象。</p></li></ul> <h3 id="_3-2-多个loader-t133-2-多个loader"><a href="#_3-2-多个loader-t133-2-多个loader" aria-hidden="true" class="header-anchor">#</a> 3.2 多个loader [#](#t133.2 多个loader)</h3> <p>当链式调用多个 loader 的时候，请记住它们会以相反的顺序执行。取决于数组写法格式，从右向左或者从下向上执行。</p> <ul><li>最后的 loader 最早调用，将会传入原始资源内容。</li> <li>第一个 loader 最后调用，期望值是传出 JavaScript 和 source map（可选）。</li> <li>中间的 loader 执行时，会传入前一个 loader 传出的结果。</li></ul> <h3 id="_3-3-单个loader用法-t143-3-单个loader用法"><a href="#_3-3-单个loader用法-t143-3-单个loader用法" aria-hidden="true" class="header-anchor">#</a> 3.3 单个loader用法 [#](#t143.3 单个loader用法)</h3> <ul><li>最后的 loader 最早调用，将会传入原始资源内容。</li> <li>第一个 loader 最后调用，期望值是传出 JavaScript 和 source map（可选）。</li> <li>中间的 loader 执行时，会传入前一个 loader 传出的结果。</li></ul> <h2 id="_4-用法准则-t154-用法准则"><a href="#_4-用法准则-t154-用法准则" aria-hidden="true" class="header-anchor">#</a> 4 用法准则 [#](#t154 用法准则)</h2> <h3 id="_4-1-简单-t164-1-简单"><a href="#_4-1-简单-t164-1-简单" aria-hidden="true" class="header-anchor">#</a> 4.1 简单 [#](#t164.1 简单)</h3> <ul><li>loaders 应该只做单一任务。这不仅使每个 loader 易维护，也可以在更多场景链式调用。</li></ul> <h3 id="_4-2-链式-chaining-t174-2-链式-chaining"><a href="#_4-2-链式-chaining-t174-2-链式-chaining" aria-hidden="true" class="header-anchor">#</a> 4.2 链式(Chaining) [#](#t174.2 链式(Chaining))</h3> <ul><li>利用 loader 可以链式调用的优势。写五个简单的 loader 实现五项任务，而不是一个 loader 实现五项任务</li></ul> <h3 id="_4-3-模块化-modular-t184-3-模块化-modular"><a href="#_4-3-模块化-modular-t184-3-模块化-modular" aria-hidden="true" class="header-anchor">#</a> 4.3 模块化(Modular) [#](#t184.3 模块化(Modular))</h3> <p>保证输出模块化。loader 生成的模块与普通模块遵循相同的设计原则。</p> <h3 id="_4-4-无状态-stateless-t194-4-无状态-stateless"><a href="#_4-4-无状态-stateless-t194-4-无状态-stateless" aria-hidden="true" class="header-anchor">#</a> 4.4 无状态(Stateless) [#](#t194.4 无状态(Stateless))</h3> <p>确保 loader 在不同模块转换之间不保存状态。每次运行都应该独立于其他编译模块以及相同模块之前的编译结果。</p> <h3 id="_4-5-loader-工具库-loader-utilities-t204-5-loader-工具库-loader-utilities"><a href="#_4-5-loader-工具库-loader-utilities-t204-5-loader-工具库-loader-utilities" aria-hidden="true" class="header-anchor">#</a> 4.5 loader 工具库(Loader Utilities) [#](#t204.5 loader 工具库(Loader Utilities))</h3> <ul><li><p><a href="loader-utils">https://github.com/webpack/loader-utils</a> 包。它提供了许多有用的工具，但最常用的一种工具是获取传递给 loader 的选项</p></li> <li><p><a href="schema-utils">https://github.com/webpack-contrib/schema-utils</a> 包配合 loader-utils，用于保证 loader 选项，进行与 JSON Schema 结构一致的校验</p></li></ul> <h3 id="_4-6-loader-依赖-loader-dependencies-t214-6-loader-依赖-loader-dependencies"><a href="#_4-6-loader-依赖-loader-dependencies-t214-6-loader-依赖-loader-dependencies" aria-hidden="true" class="header-anchor">#</a> 4.6 loader 依赖(Loader Dependencies) [#](#t214.6 loader 依赖(Loader Dependencies))</h3> <p>如果一个 loader 使用外部资源（例如，从文件系统读取），必须声明它。这些信息用于使缓存 loaders 无效，以及在观察模式(watch mode)下重编译。</p> <h3 id="_4-7-模块依赖-module-dependencies-t224-7-模块依赖-module-dependencies"><a href="#_4-7-模块依赖-module-dependencies-t224-7-模块依赖-module-dependencies" aria-hidden="true" class="header-anchor">#</a> 4.7 模块依赖(Module Dependencies) [#](#t224.7 模块依赖(Module Dependencies))</h3> <p>根据模块类型，可能会有不同的模式指定依赖关系。例如在 CSS 中，使用 @import 和 url(...) 语句来声明依赖。这些依赖关系应该由模块系统解析。</p> <h3 id="_4-8-绝对路径-absolute-paths-t234-8-绝对路径-absolute-paths"><a href="#_4-8-绝对路径-absolute-paths-t234-8-绝对路径-absolute-paths" aria-hidden="true" class="header-anchor">#</a> 4.8 绝对路径(Absolute Paths) [#](#t234.8 绝对路径(Absolute Paths))</h3> <p>不要在模块代码中插入绝对路径，因为当项目根路径变化时，文件绝对路径也会变化。<code>loader-utils</code> 中的 <code>stringifyRequest</code> 方法，可以将绝对路径转化为相对路径。</p> <h3 id="_4-9-同等依赖-peer-dependencies-t244-9-同等依赖-peer-dependencies"><a href="#_4-9-同等依赖-peer-dependencies-t244-9-同等依赖-peer-dependencies" aria-hidden="true" class="header-anchor">#</a> 4.9 同等依赖(Peer Dependencies) [#](#t244.9 同等依赖(Peer Dependencies))</h3> <ul><li>如果你的 loader 简单包裹另外一个包，你应该把这个包作为一个 peerDependency 引入。</li> <li>这种方式允许应用程序开发者在必要情况下，在 package.json 中指定所需的确定版本。</li></ul> <h2 id="_5-api-t255-api"><a href="#_5-api-t255-api" aria-hidden="true" class="header-anchor">#</a> 5. API [#](#t255. API)</h2> <h3 id="_5-1-缓存结果-t265-1-缓存结果"><a href="#_5-1-缓存结果-t265-1-缓存结果" aria-hidden="true" class="header-anchor">#</a> 5.1 缓存结果 [#](#t265.1  缓存结果)</h3> <p>webpack充分地利用缓存来提高编译效率</p> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-2-异步-t275-2-异步"><a href="#_5-2-异步-t275-2-异步" aria-hidden="true" class="header-anchor">#</a> 5..2 异步 [#](#t275..2 异步)</h3> <p>当一个 Loader 无依赖，可异步的时候我想都应该让它不再阻塞地去异步</p> <pre><code>// 让 Loader 缓存
module.exports = function(source) {
    var callback = this.async();
    // 做异步的事
    doSomeAsyncOperation(content, function(err, result) {
        if(err) return callback(err);
        callback(null, result);
    });
};
</code></pre> <h3 id="_5-3-raw-loader-t285-3-raw-loader"><a href="#_5-3-raw-loader-t285-3-raw-loader" aria-hidden="true" class="header-anchor">#</a> 5.3 raw loader [#](#t285.3 raw loader)</h3> <p>默认的情况源文件是以 <code>UTF-8</code> 字符串的形式传入给 Loader,设置<code>module.exports.raw = true</code>可使用 buffer 的形式进行处理</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>raw <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-4-获得-loader-的-options-t295-4-获得-loader-的-options"><a href="#_5-4-获得-loader-的-options-t295-4-获得-loader-的-options" aria-hidden="true" class="header-anchor">#</a> 5.4 获得 Loader 的 options [#](#t295.4 获得 Loader 的 options)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 获取到用户给当前 Loader 传入的 options</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-5-返回其它结果-t305-5-返回其它结果"><a href="#_5-5-返回其它结果-t305-5-返回其它结果" aria-hidden="true" class="header-anchor">#</a> 5.5 返回其它结果 [#](#t305.5  返回其它结果)</h3> <p>Loader有些场景下还需要返回除了内容之外的东西。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 通过 this.callback 告诉 Webpack 返回的结果</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> source<span class="token punctuation">,</span> sourceMaps<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 当你使用 this.callback 返回内容时，该 Loader 必须返回 undefined，</span>
  <span class="token comment">// 以让 Webpack 知道该 Loader 返回的结果在 this.callback 中，而不是 return 中</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>完整格式</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>
    <span class="token comment">// 当无法转换原内容时，给 Webpack 返回一个 Error</span>
    err<span class="token punctuation">:</span> Error <span class="token operator">|</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    <span class="token comment">// 原内容转换后的内容</span>
    content<span class="token punctuation">:</span> string <span class="token operator">|</span> Buffer<span class="token punctuation">,</span>
    <span class="token comment">// 用于把转换后的内容得出原内容的 Source Map，方便调试</span>
    sourceMap<span class="token operator">?</span><span class="token punctuation">:</span> SourceMap<span class="token punctuation">,</span>
    <span class="token comment">// 如果本次转换为原内容生成了 AST 语法树，可以把这个 AST 返回，</span>
    <span class="token comment">// 以方便之后需要 AST 的 Loader 复用该 AST，以避免重复生成 AST，提升性能</span>
    abstractSyntaxTree<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token constant">AST</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-6-同步与异步-t315-6-同步与异步"><a href="#_5-6-同步与异步-t315-6-同步与异步" aria-hidden="true" class="header-anchor">#</a> 5.6 同步与异步 [#](#t315.6  同步与异步)</h3> <p>Loader 有同步和异步之分，上面介绍的 Loader 都是同步的 Loader，因为它们的转换流程都是同步的，转换完成后再返回结果。 但在有些场景下转换的步骤只能是异步完成的，例如你需要通过网络请求才能得出结果，如果采用同步的方式网络请求就会阻塞整个构建，导致构建非常缓慢。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 告诉 Webpack 本次转换是异步的，Loader 会在 callback 中回调结果</span>
    <span class="token keyword">var</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">someAsyncOperation</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">,</span> sourceMaps<span class="token punctuation">,</span> ast<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 通过 callback 返回异步执行后的结果</span>
        <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> result<span class="token punctuation">,</span> sourceMaps<span class="token punctuation">,</span> ast<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_1-4-7-处理二进制数据-t321-4-7-处理二进制数据"><a href="#_1-4-7-处理二进制数据-t321-4-7-处理二进制数据" aria-hidden="true" class="header-anchor">#</a> 1.4.7 处理二进制数据 [#](#t321.4.7  处理二进制数据)</h4> <p>在默认的情况下，Webpack 传给 Loader 的原内容都是 UTF-8 格式编码的字符串。 但有些场景下 Loader 不是处理文本文件，而是处理二进制文件，例如 file-loader，就需要 Webpack 给 Loader 传入二进制格式的数据。 为此，你需要这样编写 Loader：</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在 exports.raw === true 时，Webpack 传给 Loader 的 source 是 Buffer 类型的</span>
    source <span class="token keyword">instanceof</span> <span class="token class-name">Buffer</span> <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token comment">// Loader 返回的类型也可以是 Buffer 类型的</span>
    <span class="token comment">// 在 exports.raw !== true 时，Loader 也可以返回 Buffer 类型的结果</span>
    <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 通过 exports.raw 属性告诉 Webpack 该 Loader 是否需要二进制数据</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>raw <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-8-缓存-t335-8-缓存"><a href="#_5-8-缓存-t335-8-缓存" aria-hidden="true" class="header-anchor">#</a> 5.8 缓存 [#](#t335.8  缓存)</h3> <p>在有些情况下，有些转换操作需要大量计算非常耗时，如果每次构建都重新执行重复的转换操作，构建将会变得非常缓慢。 为此，Webpack 会默认缓存所有 Loader 的处理结果，也就是说在需要被处理的文件或者其依赖的文件没有发生变化时， 是不会重新调用对应的 Loader 去执行转换操作的。</p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 关闭该 Loader 的缓存功能</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> source<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_5-9-其它-loader-api-t345-9-其它-loader-api"><a href="#_5-9-其它-loader-api-t345-9-其它-loader-api" aria-hidden="true" class="header-anchor">#</a> 5.9 其它 Loader API [#](#t345.9 其它 Loader API)</h3> <ul><li><a href="https://webpack.js.org/api/loaders/" target="_blank" rel="noopener noreferrer">完整API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <table><thead><tr><th>方法名</th> <th>含义</th></tr></thead> <tbody><tr><td><code>this.context</code></td> <td>当前处理文件的所在目录，假如当前 Loader 处理的文件是 /src/main.js，则 this.context 就等于 /src</td></tr> <tr><td><code>this.resource</code></td> <td>当前处理文件的完整请求路径，包括 querystring，例如 /src/main.js?name=1。</td></tr> <tr><td><code>this.resourcePath</code></td> <td>当前处理文件的路径，例如 /src/main.js</td></tr> <tr><td><code>this.resourceQuery</code></td> <td>当前处理文件的 querystring</td></tr> <tr><td><code>this.target</code></td> <td>等于 Webpack 配置中的 Target</td></tr> <tr><td><code>this.loadModule</code></td> <td>但 Loader 在处理一个文件时，如果依赖其它文件的处理结果才能得出当前文件的结果时,就可以通过 this.loadModule(request: string, callback: function(err, source, sourceMap, module)) 去获得 request 对应文件的处理结果</td></tr> <tr><td><code>this.resolve</code></td> <td>像 require 语句一样获得指定文件的完整路径，使用方法为 resolve(context: string, request: string, callback: function(err, result: string))</td></tr> <tr><td><code>his.addDependency</code></td> <td>给当前处理文件添加其依赖的文件，以便再其依赖的文件发生变化时，会重新调用 Loader 处理该文件。使用方法为 addDependency(file: string)</td></tr> <tr><td><code>this.addContextDependency</code></td> <td>和 addDependency 类似，但 addContextDependency 是把整个目录加入到当前正在处理文件的依赖中。使用方法为 addContextDependency(directory: string)</td></tr> <tr><td><code>this.clearDependencies</code></td> <td>清除当前正在处理文件的所有依赖，使用方法为 clearDependencies()</td></tr> <tr><td><code>this.emitFile</code></td> <td>输出一个文件，使用方法为 emitFile(name: string, content: Buffer/string, sourceMap: {...})</td></tr></tbody></table> <h2 id="_6-loader实战"><a href="#_6-loader实战" aria-hidden="true" class="header-anchor">#</a> 6.loader实战 <a href="#t356.loader%E5%AE%9E%E6%88%98">#</a></h2> <p>loader-utils,schema-utils,this.async,this.cacheable,getOptions,validateOptions,addDependency</p> <h3 id="_6-1-webpack-bannerloader-t366-1-webpack-bannerloader"><a href="#_6-1-webpack-bannerloader-t366-1-webpack-bannerloader" aria-hidden="true" class="header-anchor">#</a> 6.1 webpack.BannerLoader [#](#t366.1 webpack.BannerLoader)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{</span> getOptions <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> validateOptions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'schema-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> schema<span class="token operator">=</span><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> <span class="token string">'object'</span><span class="token punctuation">,</span>
    properties<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        template<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            type<span class="token punctuation">:</span><span class="token string">'string'</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cacheable<span class="token operator">&amp;&amp;</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> options<span class="token operator">=</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">validateOptions</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span>options<span class="token punctuation">,</span><span class="token string">'Banner-Loader'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> template<span class="token operator">=</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addDependency</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>template<span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>data<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>data<span class="token operator">+</span><span class="token string">&quot;\n&quot;</span><span class="token operator">+</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-2-pitch-t376-2-pitch"><a href="#_6-2-pitch-t376-2-pitch" aria-hidden="true" class="header-anchor">#</a> 6.2 pitch [#](#t376.2 pitch)</h3> <h4 id="_6-2-1-md-loader1-js-t386-2-1-md-loader1-js"><a href="#_6-2-1-md-loader1-js-t386-2-1-md-loader1-js" aria-hidden="true" class="header-anchor">#</a> 6.2.1 md-loader1.js [#](#t386.2.1 md-loader1.js)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">normal</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`console.log(&quot;1</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;)`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">pitch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>normal<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>pitch<span class="token operator">=</span>pitch<span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-2-2-md-loader2-js-t396-2-2-md-loader2-js"><a href="#_6-2-2-md-loader2-js-t396-2-2-md-loader2-js" aria-hidden="true" class="header-anchor">#</a> 6.2.2 md-loader2.js [#](#t396.2.2 md-loader2.js)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">normal</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`2</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">pitch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>normal<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>pitch<span class="token operator">=</span>pitch<span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-2-3-md-loader3-js-t406-2-3-md-loader3-js"><a href="#_6-2-3-md-loader3-js-t406-2-3-md-loader3-js" aria-hidden="true" class="header-anchor">#</a> 6.2.3 md-loader3.js [#](#t406.2.3 md-loader3.js)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">normal</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`3</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">pitch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>normal<span class="token punctuation">;</span>
exports<span class="token punctuation">.</span>pitch<span class="token operator">=</span>pitch<span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.md$/</span><span class="token punctuation">,</span>
  use<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'md-loader'</span><span class="token punctuation">,</span><span class="token string">'md-loader'</span><span class="token punctuation">,</span><span class="token string">'md-loader'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_6-3-css-t416-3-css"><a href="#_6-3-css-t416-3-css" aria-hidden="true" class="header-anchor">#</a> 6.3 css [#](#t416.3 css)</h3> <h4 id="_6-3-1-less-loader-js-t426-3-1-less-loader-js"><a href="#_6-3-1-less-loader-js-t426-3-1-less-loader-js" aria-hidden="true" class="header-anchor">#</a> 6.3.1 less-loader.js [#](#t426.3.1 less-loader.js)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> less<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'less'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    less<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>output<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>output<span class="token punctuation">.</span>css<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_6-3-2-style-loader-t436-3-2-style-loader"><a href="#_6-3-2-style-loader-t436-3-2-style-loader" aria-hidden="true" class="header-anchor">#</a> 6.3.2 style-loader [#](#t436.3.2 style-loader)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> less<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'less'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> loaderUtils<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;loader-utils&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 module<span class="token punctuation">.</span><span class="token function-variable function">exports</span><span class="token operator">=</span><span class="token keyword">function</span> <span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> script<span class="token operator">=</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`
      let style = document.createElement(&quot;style&quot;);
      style.innerHTML = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
      document.head.appendChild(style);
    `</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> script<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
module.exports.pitch=function (request,preceding,data) {
    let script=(`
        let style = document.createElement(&quot;style&quot;);
        let source=require(${loaderUtils.stringifyRequest(this, '!!' + request)});
        style.innerHTML = source;
        document.head.appendChild(style);
    `);
    return script;
}
*/</span>
</code></pre></div><h3 id="_6-4-file-t446-4-file"><a href="#_6-4-file-t446-4-file" aria-hidden="true" class="header-anchor">#</a> 6.4 file [#](#t446.4 file)</h3> <h4 id="_6-4-1-file-loader-t456-4-1-file-loader"><a href="#_6-4-1-file-loader-t456-4-1-file-loader" aria-hidden="true" class="header-anchor">#</a> 6.4.1 file-loader [#](#t456.4.1 file-loader)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> getOptions<span class="token punctuation">,</span>interpolateName <span class="token punctuation">}</span>  <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> options<span class="token operator">=</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token operator">=</span>options<span class="token punctuation">;</span>
    <span class="token keyword">let</span> url <span class="token operator">=</span> <span class="token function">interpolateName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token operator">?</span>name<span class="token punctuation">:</span><span class="token string">&quot;[hash]&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        content
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitFile</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`module.exports = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
loader<span class="token punctuation">.</span>raw<span class="token operator">=</span><span class="token boolean">true</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>loader<span class="token punctuation">;</span>
</code></pre></div><h4 id="_6-4-2-url-loader-t466-4-2-url-loader"><a href="#_6-4-2-url-loader-t466-4-2-url-loader" aria-hidden="true" class="header-anchor">#</a> 6.4.2 url-loader [#](#t466.4.2 url-loader)</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span>getOptions<span class="token punctuation">}</span><span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> mime <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mime'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> options<span class="token operator">=</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span>limit<span class="token punctuation">}</span><span class="token operator">=</span>options<span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    limit <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>limit<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> file<span class="token operator">=</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourcePath<span class="token punctuation">;</span>
    <span class="token keyword">debugger</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> mimetype <span class="token operator">=</span> options<span class="token punctuation">.</span>mimetype <span class="token operator">||</span> mime<span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>limit <span class="token operator">||</span> src<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> limit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> src <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      src <span class="token operator">=</span> Buffer<span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`module.exports = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>`data<span class="token punctuation">:</span>$<span class="token punctuation">{</span>mimetype <span class="token operator">||</span> <span class="token string">''</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;base64,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>src<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">}</span>`<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">const</span> fallback <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>fallback <span class="token operator">?</span> options<span class="token punctuation">.</span>fallback <span class="token punctuation">:</span> <span class="token string">'file-loader'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> fallback<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> src<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports<span class="token operator">=</span>loader<span class="token punctuation">;</span>
</code></pre></div><h3 id="_6-4-html-layout-loader-t476-4-html-layout-loader"><a href="#_6-4-html-layout-loader-t476-4-html-layout-loader" aria-hidden="true" class="header-anchor">#</a> 6.4 html-layout-loader [#](#t476.4 html-layout-loader)</h3> <h3 id="_6-4-1-webpack-config-js-t486-4-1-webpack-config-js"><a href="#_6-4-1-webpack-config-js-t486-4-1-webpack-config-js" aria-hidden="true" class="header-anchor">#</a> 6.4.1 webpack.config.js [#](#t486.4.1 webpack.config.js)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  test<span class="token punctuation">:</span> <span class="token regex">/\.html$/</span><span class="token punctuation">,</span>
     use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> <span class="token string">'html-layout-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
              layout<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">,</span> <span class="token string">'layout.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              placeholder<span class="token punctuation">:</span> <span class="token string">'{{__content__}}'</span>
     <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

plugins<span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token punctuation">:</span> <span class="token string">'./src/login.html'</span><span class="token punctuation">,</span>
            filename<span class="token punctuation">:</span> <span class="token string">'login.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            template<span class="token punctuation">:</span> <span class="token string">'./src/home.html'</span><span class="token punctuation">,</span>
            filename<span class="token punctuation">:</span> <span class="token string">'home.html'</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="_6-4-2-html-layout-loader-t496-4-2-html-layout-loader"><a href="#_6-4-2-html-layout-loader-t496-4-2-html-layout-loader" aria-hidden="true" class="header-anchor">#</a> 6.4.2 html-layout-loader [#](#t496.4.2 html-layout-loader)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    placeholder<span class="token punctuation">:</span> <span class="token string">'{{__content__}}'</span><span class="token punctuation">,</span>
    decorator<span class="token punctuation">:</span> <span class="token string">'layout'</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cacheable <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> defaultOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> placeholder<span class="token punctuation">,</span> decorator<span class="token punctuation">,</span> layout <span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> html<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>placeholder<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`module.exports = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> defaultOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
    placeholder<span class="token punctuation">:</span><span class="token string">'{{__content__}}'</span><span class="token punctuation">,</span>
    decorator<span class="token punctuation">:</span><span class="token string">'layout'</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> callback <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cacheable<span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token operator">...</span>loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">...</span>defaultOptions<span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span>placeholder<span class="token punctuation">,</span>layout<span class="token punctuation">,</span>decorator<span class="token punctuation">}</span> <span class="token operator">=</span> options<span class="token punctuation">;</span>
    <span class="token keyword">const</span> layoutReg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>decorator<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">\\((.+?)\\)`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> result <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>layoutReg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">{</span>
        source <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">render</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>context<span class="token punctuation">,</span>result<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> placeholder<span class="token punctuation">,</span> source<span class="token punctuation">,</span> callback<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token function">render</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> placeholder<span class="token punctuation">,</span> source<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> placeholder<span class="token punctuation">,</span> source<span class="token punctuation">,</span> callback<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>layout<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> html<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        html <span class="token operator">=</span> html<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>placeholder<span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token string">`module.exports = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_7-loader测试"><a href="#_7-loader测试" aria-hidden="true" class="header-anchor">#</a> 7.loader测试 <a href="#t507.loader%E6%B5%8B%E8%AF%95">#</a></h2> <h3 id="_7-1-安装依赖-t517-1-安装依赖"><a href="#_7-1-安装依赖-t517-1-安装依赖" aria-hidden="true" class="header-anchor">#</a> 7.1 安装依赖 [#](#t517.1 安装依赖)</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>cnpm <span class="token function">install</span> --save-dev jest babel-jest babel-preset-env
cnpm <span class="token function">install</span> --save-dev webpack memory-fs
</code></pre></div><h3 id="_7-2-babelrc-t527-2-babelrc"><a href="#_7-2-babelrc-t527-2-babelrc" aria-hidden="true" class="header-anchor">#</a> 7.2 .babelrc [#](#t527.2 .babelrc)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>
    <span class="token string">&quot;env&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-3-src-loader-js-t537-3-src-loader-js"><a href="#_7-3-src-loader-js-t537-3-src-loader-js" aria-hidden="true" class="header-anchor">#</a> 7.3 src/loader.js [#](#t537.3 src/loader.js)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getOptions <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'loader-utils'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  source <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\[name\]/g</span><span class="token punctuation">,</span> options<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`export default </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-4-test-example-txt-t547-4-test-example-txt"><a href="#_7-4-test-example-txt-t547-4-test-example-txt" aria-hidden="true" class="header-anchor">#</a> 7.4 test/example.txt [#](#t547.4 test/example.txt)</h3> <pre><code>hello [name]
</code></pre> <h3 id="_7-5-test-compiler-js-t557-5-test-compiler-js"><a href="#_7-5-test-compiler-js-t557-5-test-compiler-js" aria-hidden="true" class="header-anchor">#</a> 7.5 test/compiler.js [#](#t557.5 test/compiler.js)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">'path'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> webpack <span class="token keyword">from</span> <span class="token string">'webpack'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> memoryfs <span class="token keyword">from</span> <span class="token string">'memory-fs'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span>fixture<span class="token punctuation">,</span> options <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    context<span class="token punctuation">:</span> __dirname<span class="token punctuation">,</span>
    entry<span class="token punctuation">:</span> <span class="token template-string"><span class="token string">`./</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>fixture<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">,</span>
    output<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      path<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">)</span><span class="token punctuation">,</span>
      filename<span class="token punctuation">:</span> <span class="token string">'bundle.js'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    module<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      rules<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
        test<span class="token punctuation">:</span> <span class="token regex">/\.txt$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'../src/loader.js'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            name<span class="token punctuation">:</span> <span class="token string">'Alice'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  compiler<span class="token punctuation">.</span>outputFileSystem <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">memoryfs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span>resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> stats<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">resolve</span><span class="token punctuation">(</span>stats<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_7-6-test-loader-test-js-t567-6-test-loader-test-js"><a href="#_7-6-test-loader-test-js-t567-6-test-loader-test-js" aria-hidden="true" class="header-anchor">#</a> 7.6 test/loader.test.js [#](#t567.6  test/loader.test.js)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> compiler <span class="token keyword">from</span> <span class="token string">'./compiler.js'</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'Inserts name and outputs JavaScript'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   <span class="token keyword">const</span> stats<span class="token operator">=</span><span class="token keyword">await</span> <span class="token function">compiler</span><span class="token punctuation">(</span><span class="token string">'example.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">const</span> output <span class="token operator">=</span> stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>modules<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>source<span class="token punctuation">;</span>
   <span class="token function">expect</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`export default \&quot;Hey Alice!\&quot;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_7-7-package-json-t577-7-package-json"><a href="#_7-7-package-json-t577-7-package-json" aria-hidden="true" class="header-anchor">#</a> 7.7 package.json [#](#t577.7  package.json)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token string">&quot;scripts&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;test&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;jest&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <!----> <div class="content page-nav"><p class="inner"><span class="prev">
          ← <a href="/fe/26.webpack-4-AST.html" class="prev">
            抽象语法树(Abstract Syntax Tree)
          </a></span> <span class="next"><a href="/fe/26.webpack-5-source.html">
            基本概念
          </a> →
        </span></p></div> <div id="comment-container"><div class="gt-container"><div class="gt-initing"><i class="gt-loader"></i> <p class="gt-initing-text">Gitalking ...</p></div> <!----> <!----> <div><div class="gt-header"><a class="gt-avatar-github"><span class="gt-ico gt-ico-github"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M64 524C64 719.602 189.356 885.926 364.113 947.017 387.65799 953 384 936.115 384 924.767L384 847.107C248.118 863.007 242.674 773.052 233.5 758.001 215 726.501 171.5 718.501 184.5 703.501 215.5 687.501 247 707.501 283.5 761.501 309.956 800.642 361.366 794.075 387.658 787.497 393.403 763.997 405.637 743.042 422.353 726.638 281.774 701.609 223 615.67 223 513.5 223 464.053 239.322 418.406 271.465 381.627 251.142 320.928 273.421 269.19 276.337 261.415 334.458 256.131 394.888 302.993 399.549 306.685 432.663 297.835 470.341 293 512.5 293 554.924 293 592.81 297.896 626.075 306.853 637.426 298.219 693.46 258.054 747.5 262.966 750.382 270.652 772.185 321.292 753.058 381.083 785.516 417.956 802 463.809 802 513.5 802 615.874 742.99 701.953 601.803 726.786 625.381 750.003 640 782.295 640 818.008L640 930.653C640.752 939.626 640 948.664978 655.086 948.665 832.344 888.962 960 721.389 960 524 960 276.576 759.424 76 512 76 264.577 76 64 276.576 64 524Z"></path>
</svg>
</span> <!----></span></a> <div class="gt-header-comment"><textarea placeholder="Leave a comment" class="gt-header-textarea"></textarea> <div class="gt-header-preview markdown-body hide"></div> <div class="gt-header-controls"><a href="https://guides.github.com/features/mastering-markdown/" target="_blank" class="gt-header-controls-tip"><span class="gt-ico gt-ico-tip"><span class="gt-svg"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
  <path d="M512 366.949535c-16.065554 0-29.982212 13.405016-29.982212 29.879884l0 359.070251c0 16.167882 13.405016 29.879884 29.982212 29.879884 15.963226 0 29.879884-13.405016 29.879884-29.879884L541.879884 396.829419C541.879884 380.763865 528.474868 366.949535 512 366.949535L512 366.949535z"
    p-id="3083"></path>
  <path d="M482.017788 287.645048c0-7.776956 3.274508-15.553912 8.80024-21.181973 5.525732-5.525732 13.302688-8.80024 21.181973-8.80024 7.776956 0 15.553912 3.274508 21.079644 8.80024 5.525732 5.62806 8.80024 13.405016 8.80024 21.181973 0 7.776956-3.274508 15.656241-8.80024 21.181973-5.525732 5.525732-13.405016 8.697911-21.079644 8.697911-7.879285 0-15.656241-3.274508-21.181973-8.697911C485.292295 303.301289 482.017788 295.524333 482.017788 287.645048L482.017788 287.645048z"
    p-id="3084"></path>
  <path d="M512 946.844409c-239.8577 0-434.895573-195.037873-434.895573-434.895573 0-239.8577 195.037873-434.895573 434.895573-434.895573 239.755371 0 434.895573 195.037873 434.895573 434.895573C946.895573 751.806535 751.755371 946.844409 512 946.844409zM512 126.17088c-212.740682 0-385.880284 173.037274-385.880284 385.777955 0 212.740682 173.037274 385.777955 385.880284 385.777955 212.740682 0 385.777955-173.037274 385.777955-385.777955C897.777955 299.208154 724.740682 126.17088 512 126.17088z"
    p-id="3085"></path>
</svg>
</span> <span class="gt-ico-text">Markdown is supported</span></span></a> <!----> <button class="gt-btn gt-btn-preview"><span class="gt-btn-text">Preview</span> <!----></button> <button class="gt-btn gt-btn-login"><span class="gt-btn-text">Login with GitHub</span> <!----></button></div></div></div> <div class="gt-comments"><span></span> <p class="gt-comments-null">
                Be the first guy leaving a comment!
            </p> <!----></div></div></div></div></div></div> <!----></div> <div class="tool-group"><!----></div></div> <!----></div> <div class="background-mask" style="background:#f6f6f6;"></div></div></div>
    <script src="/assets/js/app.35b69267.js" defer></script><script src="/assets/js/43.b385d348.js" defer></script>
  </body>
</html>
